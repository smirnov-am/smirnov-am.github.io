<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Background jobs with Flask</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css?v=760fa4896f" />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="canonical" href="https://smirnov-am.github.io/background-jobs-with-flask/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://smirnov-am.github.io/background-jobs-with-flask/amp/" />
    
    <meta property="og:site_name" content="smirnov-am.github.io" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Background jobs with Flask" />
    <meta property="og:description" content="Basic request lifecycle with Flask goes like this:

 * Flask get request
 * parse parameters
 * does calculations
 * returns result

This synchronous task is fine when user needs the result of calculation
immediately.
Another use case is when the result is not relevant right now and user just
wants to schedule an execution of the task asynchronously.

Such scenarios include:

 * sending email
 * creating thumbnails from uploaded image

Common implementation
Asynchronous tasks are usually impleme" />
    <meta property="og:url" content="https://smirnov-am.github.io/background-jobs-with-flask/" />
    <meta property="og:image" content="https://smirnov-am.github.io/content/images/2019/04/800px_COLOURBOX2362664.jpg" />
    <meta property="article:published_time" content="2018-11-27T19:41:00.000Z" />
    <meta property="article:modified_time" content="2019-04-27T19:42:34.000Z" />
    <meta property="article:tag" content="Flask" />
    <meta property="article:tag" content="python" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Background jobs with Flask" />
    <meta name="twitter:description" content="Basic request lifecycle with Flask goes like this:

 * Flask get request
 * parse parameters
 * does calculations
 * returns result

This synchronous task is fine when user needs the result of calculation
immediately.
Another use case is when the result is not relevant right now and user just
wants to schedule an execution of the task asynchronously.

Such scenarios include:

 * sending email
 * creating thumbnails from uploaded image

Common implementation
Asynchronous tasks are usually impleme" />
    <meta name="twitter:url" content="https://smirnov-am.github.io/background-jobs-with-flask/" />
    <meta name="twitter:image" content="https://smirnov-am.github.io/content/images/2019/04/800px_COLOURBOX2362664.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Alexey Smirnov" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Flask, python" />
    <meta property="og:image:width" content="800" />
    <meta property="og:image:height" content="533" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "smirnov-am.github.io",
        "logo": {
            "@type": "ImageObject",
            "url": "https://smirnov-am.github.io/favicon.ico",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Alexey Smirnov",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/f3f61e69a3bdf7419f19cb1be356c0b1?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "https://smirnov-am.github.io/author/alexey/",
        "sameAs": []
    },
    "headline": "Background jobs with Flask",
    "url": "https://smirnov-am.github.io/background-jobs-with-flask/",
    "datePublished": "2018-11-27T19:41:00.000Z",
    "dateModified": "2019-04-27T19:42:34.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://smirnov-am.github.io/content/images/2019/04/800px_COLOURBOX2362664.jpg",
        "width": 800,
        "height": 533
    },
    "keywords": "Flask, python",
    "description": "Basic request lifecycle with Flask goes like this:\n\n * Flask get request\n * parse parameters\n * does calculations\n * returns result\n\nThis synchronous task is fine when user needs the result of calculation\nimmediately.\nAnother use case is when the result is not relevant right now and user just\nwants to schedule an execution of the task asynchronously.\n\nSuch scenarios include:\n\n * sending email\n * creating thumbnails from uploaded image\n\nCommon implementation\nAsynchronous tasks are usually impleme",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://smirnov-am.github.io/"
    }
}
    </script>

    <meta name="generator" content="Ghost 2.21" />
    <link rel="alternate" type="application/rss+xml" title="smirnov-am.github.io" href="https://smirnov-am.github.io/rss/" />
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-107429956-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-107429956-1');
</script>

</head>
<body class="post-template tag-flask tag-python">

    <div class="site-wrapper">

        

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
                <a class="site-nav-logo" href="https://smirnov-am.github.io">smirnov-am.github.io</a>
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="https://smirnov-am.github.io/">Home</a></li>
    <li class="nav-github" role="menuitem"><a href="https://github.com/smirnov-am">GitHub</a></li>
    <li class="nav-linkedin" role="menuitem"><a href="https://www.linkedin.com/in/smirnovam/">LinkedIn</a></li>
    <li class="nav-bookshelf" role="menuitem"><a href="https://www.goodreads.com/review/list/100768091-alex-smirnov">Bookshelf</a></li>
</ul>

    </div>
    <div class="site-nav-right">
        <div class="social-links">
        </div>
            <a class="rss-button" href="https://feedly.com/i/subscription/feed/https://smirnov-am.github.io/rss/" title="RSS" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg>
</a>
    </div>
</nav>
    </div>
</header>


<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post tag-flask tag-python ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="2018-11-27">27 November 2018</time>
                        <span class="date-divider">/</span> <a href="/tag/flask/">Flask</a>
                </section>
                <h1 class="post-full-title">Background jobs with Flask</h1>
            </header>

            <figure class="post-full-image">
                <img
                    srcset="/content/images/size/w300/2019/04/800px_COLOURBOX2362664.jpg 300w,
                            /content/images/size/w600/2019/04/800px_COLOURBOX2362664.jpg 600w,
                            /content/images/size/w1000/2019/04/800px_COLOURBOX2362664.jpg 1000w,
                            /content/images/size/w2000/2019/04/800px_COLOURBOX2362664.jpg 2000w"
                    sizes="(max-width: 800px) 400px,
                            (max-width: 1170px) 700px,
                            1400px"
                    src="/content/images/size/w2000/2019/04/800px_COLOURBOX2362664.jpg"
                    alt="Background jobs with Flask"
                />
            </figure>

            <section class="post-full-content">
                <div class="post-content">
                    <p>Basic request lifecycle with Flask goes like this:</p><ul><li>Flask get request</li><li>parse parameters</li><li>does calculations</li><li>returns result</li></ul><p>This synchronous task is fine when user needs the result of calculation immediately.<br>Another use case is when the result is not relevant right now and user just wants to schedule an execution of the task asynchronously.</p><p>Such scenarios include:</p><ul><li>sending email</li><li>creating thumbnails from uploaded image</li></ul><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://smirnov-am.github.io/content/images/2019/04/img1.png" class="kg-image"></figure><!--kg-card-end: image--><h2 id="common-implementation">Common implementation</h2><p>Asynchronous tasks are usually implemented like this:</p><ul><li>Flask schedules a task by putting a message into message broker (Redis, AWS SQS, RabbitMQ) upon request</li><li>The broker is made available to the pool of possibly separate machines - workers</li><li>Workers get messages from broker and execute tasks</li></ul><p>This approach has a number of advantages. Firstly, it's sharing responsibility. Instances running Flask web server are doing only one job - serving requests. If the tasks are resource demanding Flask instances won't suffer from high memory/CPU usage and will still server requests. Secondly, tasks are stored in message broker.<br>If Flask instances die it won't affect workers and task execution.</p><p>Nothing comes for free. This structure has more points of failure then alternatives. Libraries serving brokers have bugs. Also it may looks like a over-engineering for simple tasks.</p><p>Here are some good examples of such implementations: <a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xxii-background-jobs">RQ</a>, <a href="https://blog.miguelgrinberg.com/post/using-celery-with-flask">Celery</a></p><h2 id="alternatives">Alternatives</h2><h3 id="threads">Threads</h3><p>Most basic approach is to run a task in a thread. For that to work this line should be added to uwsgi configuration file:</p><!--kg-card-begin: code--><pre><code>enable-threads = true
</code></pre><!--kg-card-end: code--><p>we run <a href="https://smirnov-am.github.io/2018/08/09/flask-docker.html">Flask with uwsg in production</a> of course</p><p>Code <code>app.py</code></p><!--kg-card-begin: code--><pre><code>import os
import time
from flask import Flask, jsonify
from threading import Thread
from tasks import threaded_task

app = Flask(__name__)
app.secret_key = os.urandom(42)


@app.route("/", defaults={'duration': 5})
@app.route("/&lt;int:duration&gt;")
def index(duration):
    thread = Thread(target=threaded_task, args=(duration,))
    thread.daemon = True
    thread.start()
    return jsonify({'thread_name': str(thread.name),
                    'started': True})
</code></pre><!--kg-card-end: code--><p>code <code>tasks.py</code></p><!--kg-card-begin: code--><pre><code>import time

def threaded_task(duration):
    for i in range(duration):
        print("Working... {}/{}".format(i + 1, duration))
        time.sleep(1)
</code></pre><!--kg-card-end: code--><p>Demo:</p><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://smirnov-am.github.io/content/images/2019/04/demo1.gif" class="kg-image"></figure><!--kg-card-end: image--><h3 id="uwsgi-thread">uWSGI thread</h3><p>Creating and running thread may be delegated to uwsgi. So we don't interact with<br>threading module directly. For that there is a <code>thread</code> decorator available <code>from uwsgidecorators import thread</code> (<a href="https://uwsgi-docs.readthedocs.io/en/latest/PythonDecorators.html?highlight=thread#uwsgidecorators.thread">API docs</a>)</p><p>Code <code>app.py</code></p><!--kg-card-begin: code--><pre><code>import os
import time
from flask import Flask, jsonify
from threading import Thread
from tasks import uwsgi_task

app = Flask(__name__)
app.secret_key = os.urandom(42)


@app.route("/uwsgi_thread", defaults={'duration': 5})
@app.route("/uwsgi_thread/&lt;int:duration&gt;")
def uwsgi_thread(duration):
    uwsgi_task(duration)
    return jsonify({'started': True})
</code></pre><!--kg-card-end: code--><p>code <code>tasks.py</code></p><!--kg-card-begin: code--><pre><code>import time
from uwsgidecorators import thread


@thread
def uwsgi_task(duration):
    for i in range(duration):
        print("Working in uwsgi thread... {}/{}".format(i + 1, duration))
        time.sleep(1)
</code></pre><!--kg-card-end: code--><p>Demo:</p><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://smirnov-am.github.io/content/images/2019/04/demo2.gif" class="kg-image"></figure><!--kg-card-end: image--><h3 id="uwsgi-spooler">uWSGI spooler</h3><p>Above examples create a thread per request and can lead to some troubles when there are many of them. To control that a task may run in a <a href="https://uwsgi-docs.readthedocs.io/en/latest/Spooler.html?highlight=spooler">spooler</a> with controlled number of executors.<br>This however requires some configuration from uwsgi side (that is <code>uwsgi.ini</code>)</p><ul><li><code>spooler = my_spools</code> - a path to a directory to store files representing tasks. Directory should be created beforehand.</li><li><code>spooler-import = tasks.py</code> - a module containing task's code spooler workers will import</li><li><code>spooler-frequency = 1</code> - how ofter workers scan spool directory for tasks</li><li><code>spooler-processes = 10</code> - how many workers to run</li></ul><p>After running <code>uwsgi --ini uwsgi.ini</code> startup log shows created processes:</p><!--kg-card-begin: code--><pre><code>spawned the uWSGI spooler on dir /home/as/Desktop/blog/my_spools with pid 10609
spawned the uWSGI spooler on dir /home/as/Desktop/blog/my_spools with pid 10610
spawned the uWSGI spooler on dir /home/as/Desktop/blog/my_spools with pid 10611
spawned the uWSGI spooler on dir /home/as/Desktop/blog/my_spools with pid 10612
spawned the uWSGI spooler on dir /home/as/Desktop/blog/my_spools with pid 10613
spawned the uWSGI spooler on dir /home/as/Desktop/blog/my_spools with pid 10614
spawned the uWSGI spooler on dir /home/as/Desktop/blog/my_spools with pid 10615
spawned the uWSGI spooler on dir /home/as/Desktop/blog/my_spools with pid 10616
spawned the uWSGI spooler on dir /home/as/Desktop/blog/my_spools with pid 10617
spawned the uWSGI spooler on dir /home/as/Desktop/blog/my_spools with pid 10618
spawned uWSGI worker 1 (pid: 10619, cores: 1)
spawned uWSGI worker 2 (pid: 10620, cores: 1)
spawned uWSGI worker 3 (pid: 10621, cores: 1)
spawned uWSGI worker 4 (pid: 10622, cores: 1)
spawned uWSGI worker 5 (pid: 10623, cores: 1)
</code></pre><!--kg-card-end: code--><p><code>tasks.py</code> code is straightforward and use <code>spool</code> decorator from uwsgi.<br>The task function itself should return a predefined codes though:</p><ul><li><code>uwsgi.SPOOL_OK</code> if all went well</li><li><code>uwsgi.SPOOL_RETRY</code> if a jobs needs to be retried (if it's idempotent of course)</li></ul><!--kg-card-begin: code--><pre><code>import time
import uwsgi
from uwsgidecorators import spool


@spool
def spool_task(args):
    try:
        duration = int(args['duration'])
        for i in range(duration):
            print("Working in uwsgi spool... {}/{}".format(i + 1, duration))
            time.sleep(1)
        return uwsgi.SPOOL_OK
    except:
        return uwsgi.SPOOL_RETRY
</code></pre><!--kg-card-end: code--><p><code>app.py</code> calls <code>spool_task</code> in the route, but I struggled a but with passing parameters.<br>I was getting such error when passing them according to the docs:</p><!--kg-card-begin: code--><pre><code>ValueError: spooler callable dictionary must contains only bytes
</code></pre><!--kg-card-end: code--><p>So I came up with simple helper that converts keyword arguments to a dictionary with keys and values that have bytes only - <code>prepare_spooler_args</code>. <code>spool</code> decorator has a <code>pass_arguments</code> parameter - it may be a possible solution as well.</p><!--kg-card-begin: code--><pre><code>import os
import time
from flask import Flask, jsonify
from tasks import threaded_task, uwsgi_task, spool_task, uwsgi_tasks_task

app = Flask(__name__)
app.secret_key = os.urandom(42)


def prepare_spooler_args(**kwargs):
    args = {}
    for name, value in kwargs.items():
        args[name.encode('utf-8')] = str(value).encode('utf-8')
    return args


@app.route("/uwsgi_spool", defaults={'duration': 5})
@app.route("/uwsgi_spool/&lt;int:duration&gt;")
def uwsgi_spool(duration):
    args = prepare_spooler_args(duration=duration)
    spool_task.spool(args)
    return jsonify({'started': True})
</code></pre><!--kg-card-end: code--><p>Also <code>spool_task.spool</code> accepts an <code>at</code> parameter that tell spooler to run a task at a specified unix timestamp. To use it <code>uwsgi_spool</code> route code:</p><!--kg-card-begin: code--><pre><code>@app.route("/uwsgi_spool", defaults={'duration': 5})
@app.route("/uwsgi_spool/&lt;int:duration&gt;")
def uwsgi_spool(duration):
    at = int(time.time()) + 3 # delay by 3s
    args = prepare_spooler_args(duration=duration, at=at)
    spool_task.spool(args)
    return jsonify({'started': True})
</code></pre><!--kg-card-end: code--><p>Demo:</p><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://smirnov-am.github.io/content/images/2019/04/demo3.gif" class="kg-image"></figure><!--kg-card-end: image--><h3 id="wrapping-up-spooler">Wrapping up spooler</h3><p><code>uwsgi-tasks</code> library (<a href="https://pypi.org/project/uwsgi-tasks/">pypi</a>) wraps all the uwsgi spooler workings, especially argument passing. Also I found controlling retries as a useful feature.<br>Unfortunately after installing it previous example (bareback spooler) stopped working for me.</p><h2 id="further-thoughts-">Further thoughts.</h2><p>uSWGI spooler is great for simple tasks. It becomes more robust with external spooler support and networking, but at that level it starts resemble a common approach with all it's drawbacks.</p><p>The whole code is available at <a href="https://github.com/smirnov-am/flask-bg-tasks">GitHub</a></p><p>Do you use background jobs with Flask? Drop me a message on <a href="https://www.linkedin.com/in/smirnovam/">linkedin</a></p>
                </div>
            </section>


            <footer class="post-full-footer">


                    
<section class="author-card">
        <img class="author-profile-image" src="//www.gravatar.com/avatar/f3f61e69a3bdf7419f19cb1be356c0b1?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x" alt="Alexey Smirnov" />
    <section class="author-card-content">
        <h4 class="author-card-name"><a href="/author/alexey/">Alexey Smirnov</a></h4>
            <p>Read <a href="/author/alexey/">more posts</a> by this author.</p>
    </section>
</section>
<div class="post-full-footer-right">
    <a class="author-card-button" href="/author/alexey/">Read More</a>
</div>


            </footer>


        </article>

    </div>
</main>

<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
                <article class="read-next-card"

                >
                    <header class="read-next-card-header">
                        <small class="read-next-card-header-sitetitle">&mdash; smirnov-am.github.io &mdash;</small>
                        <h3 class="read-next-card-header-title"><a href="/tag/flask/">Flask</a></h3>
                    </header>
                    <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                    <div class="read-next-card-content">
                        <ul>
                            <li><a href="/streaming-timeseries-with-flask-and-plotly/">Streaming timeseries with Flask and Plotly</a></li>
                            <li><a href="/multitenancy-with-flask/">Multitenancy with Flask</a></li>
                            <li><a href="/flask-pagination-macro/">Flask pagination macro</a></li>
                        </ul>
                    </div>
                    <footer class="read-next-card-footer">
                        <a href="/tag/flask/">See all 5 posts →</a>
                    </footer>
                </article>

                <article class="post-card post tag-flask tag-python ">

    <a class="post-card-image-link" href="/streaming-timeseries-with-flask-and-plotly/">
        <img class="post-card-image"
            srcset="/content/images/size/w300/2019/04/task-manager-3-.png 300w,
                    /content/images/size/w600/2019/04/task-manager-3-.png 600w,
                    /content/images/size/w1000/2019/04/task-manager-3-.png 1000w,
                    /content/images/size/w2000/2019/04/task-manager-3-.png 2000w"
            sizes="(max-width: 1000px) 400px, 700px"
            src="/content/images/size/w600/2019/04/task-manager-3-.png"
            alt="Streaming timeseries with Flask and Plotly"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/streaming-timeseries-with-flask-and-plotly/">

            <header class="post-card-header">
                    <span class="post-card-tags">Flask</span>
                <h2 class="post-card-title">Streaming timeseries with Flask and Plotly</h2>
            </header>

            <section class="post-card-excerpt">
                <p>This simple app for streaming cpu utilization to a web page. I'm using Flask as websockets server (flask-socketio plugin), socket.io as client library and plotly.jsfor visualization.Flask appI'm following a flask-socketio</p>
            </section>

        </a>

        <footer class="post-card-meta">

            <ul class="author-list">
                <li class="author-list-item">

                    <div class="author-name-tooltip">
                        Alexey Smirnov
                    </div>

                        <a href="/author/alexey/" class="static-avatar">
                            <img class="author-profile-image" src="//www.gravatar.com/avatar/f3f61e69a3bdf7419f19cb1be356c0b1?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x" alt="Alexey Smirnov" />
                        </a>
                </li>
            </ul>

            <span class="reading-time">3 min read</span>

        </footer>

    </div>

</article>

                <article class="post-card post tag-flask tag-python ">

    <a class="post-card-image-link" href="/multitenancy-with-flask/">
        <img class="post-card-image"
            srcset="/content/images/size/w300/2019/04/social-housing-landlords-tenants-scotland-act-2014-tenancy-short-secure-law-lawyer-eviction.jpg 300w,
                    /content/images/size/w600/2019/04/social-housing-landlords-tenants-scotland-act-2014-tenancy-short-secure-law-lawyer-eviction.jpg 600w,
                    /content/images/size/w1000/2019/04/social-housing-landlords-tenants-scotland-act-2014-tenancy-short-secure-law-lawyer-eviction.jpg 1000w,
                    /content/images/size/w2000/2019/04/social-housing-landlords-tenants-scotland-act-2014-tenancy-short-secure-law-lawyer-eviction.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 700px"
            src="/content/images/size/w600/2019/04/social-housing-landlords-tenants-scotland-act-2014-tenancy-short-secure-law-lawyer-eviction.jpg"
            alt="Multitenancy with Flask"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/multitenancy-with-flask/">

            <header class="post-card-header">
                    <span class="post-card-tags">Flask</span>
                <h2 class="post-card-title">Multitenancy with Flask</h2>
            </header>

            <section class="post-card-excerpt">
                <p>What is multitenancyConsider a SaaS platform that provide access to multiple client organizations.These organizations - tenants - may have each its own database for safety and data protection reasons.It can be</p>
            </section>

        </a>

        <footer class="post-card-meta">

            <ul class="author-list">
                <li class="author-list-item">

                    <div class="author-name-tooltip">
                        Alexey Smirnov
                    </div>

                        <a href="/author/alexey/" class="static-avatar">
                            <img class="author-profile-image" src="//www.gravatar.com/avatar/f3f61e69a3bdf7419f19cb1be356c0b1?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x" alt="Alexey Smirnov" />
                        </a>
                </li>
            </ul>

            <span class="reading-time">2 min read</span>

        </footer>

    </div>

</article>

        </div>
    </div>
</aside>

<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://smirnov-am.github.io">
            <span>smirnov-am.github.io</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Background jobs with Flask</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-fb" href="https://www.linkedin.com/shareArticle?url=https://smirnov-am.github.io/background-jobs-with-flask/&title=Background%20jobs%20with%20Flask" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
width="26" height="26"
viewBox="0 0 192 192"
style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,192v-192h192v192z" fill="none"></path><g fill="#ffffff"><g id="surface1"><path d="M156,0h-120c-19.875,0 -36,16.125 -36,36v120c0,19.875 16.125,36 36,36h120c19.875,0 36,-16.125 36,-36v-120c0,-19.875 -16.125,-36 -36,-36zM59.36539,162.98077h-29.82693l-0.17307,-89.30769h29.82692zM43.70192,61.99038h-0.17308c-9.75,0 -16.03846,-6.72115 -16.03846,-15.08653c0,-8.56731 6.49039,-15.0577 16.41347,-15.0577c9.92308,0 16.00961,6.49038 16.21153,15.0577c0,8.36538 -6.31731,15.08653 -16.41346,15.08653zM162.77885,162.98077h-30.08654v-48.51923c0,-11.74039 -3.11538,-19.73077 -13.61538,-19.73077c-8.01923,0 -12.34615,5.39423 -14.42308,10.61538c-0.77885,1.875 -0.98077,4.44231 -0.98077,7.06731v50.56731h-30.23077l-0.17308,-89.30769h30.23077l0.17308,12.60577c3.86538,-5.97116 10.29808,-14.42308 25.70192,-14.42308c19.09616,0 33.37501,12.46154 33.37501,39.25961v51.86539z"></path></g></g></g></svg>
</a>
        <a class="floating-header-share-tw" href="http://www.reddit.com/submit?url=https://smirnov-am.github.io/background-jobs-with-flask/&title=Background%20jobs%20with%20Flask" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M14.238 15.348c.085.084.085.221 0 .306-.465.462-1.194.687-2.231.687l-.008-.002-.008.002c-1.036 0-1.766-.225-2.231-.688-.085-.084-.085-.221 0-.305.084-.084.222-.084.307 0 .379.377 1.008.561 1.924.561l.008.002.008-.002c.915 0 1.544-.184 1.924-.561.085-.084.223-.084.307 0zm-3.44-2.418c0-.507-.414-.919-.922-.919-.509 0-.923.412-.923.919 0 .506.414.918.923.918.508.001.922-.411.922-.918zm13.202-.93c0 6.627-5.373 12-12 12s-12-5.373-12-12 5.373-12 12-12 12 5.373 12 12zm-5-.129c0-.851-.695-1.543-1.55-1.543-.417 0-.795.167-1.074.435-1.056-.695-2.485-1.137-4.066-1.194l.865-2.724 2.343.549-.003.034c0 .696.569 1.262 1.268 1.262.699 0 1.267-.566 1.267-1.262s-.568-1.262-1.267-1.262c-.537 0-.994.335-1.179.804l-2.525-.592c-.11-.027-.223.037-.257.145l-.965 3.038c-1.656.02-3.155.466-4.258 1.181-.277-.255-.644-.415-1.05-.415-.854.001-1.549.693-1.549 1.544 0 .566.311 1.056.768 1.325-.03.164-.05.331-.05.5 0 2.281 2.805 4.137 6.253 4.137s6.253-1.856 6.253-4.137c0-.16-.017-.317-.044-.472.486-.261.82-.766.82-1.353zm-4.872.141c-.509 0-.922.412-.922.919 0 .506.414.918.922.918s.922-.412.922-.918c0-.507-.413-.919-.922-.919z"/></svg></a>
        <a class="floating-header-share-fb" href="https://news.ycombinator.com/submitlink?u=https://smirnov-am.github.io/background-jobs-with-flask/&t=Background%20jobs%20with%20Flask" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
width="100" height="100"
viewBox="0 0 50 50"
style=" fill:#000000;">    <path d="M 4 4 L 4 5 L 4 46 L 46 46 L 46 4 L 4 4 z M 6 6 L 44 6 L 44 44 L 6 44 L 6 6 z M 12.652344 13 L 14.238281 15.947266 L 21 28.503906 L 21 36 L 21 38 L 23 38 L 27 38 L 29 38 L 29 36 L 29 28.503906 L 35.761719 15.947266 L 37.347656 13 L 34 13 L 30.824219 13 L 29.664062 13 L 29.087891 14.007812 L 25 21.158203 L 20.912109 14.007812 L 20.337891 13 L 19.177734 13 L 16 13 L 12.652344 13 z M 16 15 L 19.175781 15 L 25 25.1875 L 30.824219 15 L 34 15 L 27 28 L 27 36 L 23 36 L 23 28 L 16 15 z"></path></svg></a>
    </div>
    <progress id="reading-progress" class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>




        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://smirnov-am.github.io">smirnov-am.github.io</a> &copy; 2019</section>
                <nav class="site-footer-nav">
                    <a href="https://smirnov-am.github.io">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>


    <script>
        var images = document.querySelectorAll('.kg-gallery-image img');
        images.forEach(function (image) {
            var container = image.closest('.kg-gallery-image');
            var width = image.attributes.width.value;
            var height = image.attributes.height.value;
            var ratio = width / height;
            container.style.flex = ratio + ' 1 0%';
        })
    </script>


    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/built/jquery.fitvids.js?v=760fa4896f"></script>


    <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('#reading-progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();

});
</script>


    

</body>
</html>
