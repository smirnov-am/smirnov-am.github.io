<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https:\/\/smirnov-am.github.io"
        },
        "articleSection" : "post",
        "name" : "Selecting tests with pytest",
        "headline" : "Selecting tests with pytest",
        "description" : "Other pytest articles:\nWhy testing is important\nTypes of tests\nTest driven Development\nHello, World!\nSelecting tests with pytest\nTesting HTTP client with pytest\nTesting database with pytest\nAdvanced fixtures with pytest\nPytest plugins\nLet\u0026rsquo;s add another requirement for our normalize function - it will raise an exception if the number contains a letter, or if a plus sign is not at the beginning.\nNow let’s think a bit about the design of the application.",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2020",
        "datePublished": "2020-09-06 18:41:00 \u002b0000 UTC",
        "dateModified" : "2020-09-06 18:41:00 \u002b0000 UTC",
        "url" : "https:\/\/smirnov-am.github.io\/pytest-selecting_tests\/",
        "wordCount" : "526",
        "keywords" : [ "Python","pytest","Blog" ]
    }
    </script>

<title>Selecting tests with pytest | Alexey Smirnov</title>

<meta property='og:title' content='Selecting tests with pytest - Alexey Smirnov'>
<meta property='og:description' content='Other pytest articles:
Why testing is important
Types of tests
Test driven Development
Hello, World!
Selecting tests with pytest
Testing HTTP client with pytest
Testing database with pytest
Advanced fixtures with pytest
Pytest plugins
Let&rsquo;s add another requirement for our normalize function - it will raise an exception if the number contains a letter, or if a plus sign is not at the beginning.
Now let’s think a bit about the design of the application.'>
<meta property='og:url' content='https://smirnov-am.github.io/pytest-selecting_tests/'>
<meta property='og:site_name' content='Alexey Smirnov'>
<meta property='og:type' content='article'><meta property='og:image' content='https://www.gravatar.com/avatar/f3f61e69a3bdf7419f19cb1be356c0b1?s=256'><meta property='article:section' content='Post'><meta property='article:tag' content='Python'><meta property='article:tag' content='pytest'><meta property='article:published_time' content='2020-09-06T18:41:00Z'/><meta property='article:modified_time' content='2020-09-06T18:41:00Z'/><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@'><meta name='twitter:creator' content='@'>


<link href="https://smirnov-am.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Alexey Smirnov" />

<link rel="stylesheet" href="https://smirnov-am.github.io/css/style.css"/><link rel="apple-touch-icon" sizes="180x180" href="https://smirnov-am.github.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://smirnov-am.github.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://smirnov-am.github.io/favicon-16x16.png">
<link rel="manifest" href="https://smirnov-am.github.io/site.webmanifest">
<link rel="mask-icon" href="https://smirnov-am.github.io/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://smirnov-am.github.io/pytest-selecting_tests/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<meta name="google-site-verification" content="LxHvTgaBdcBpIRtJMFKFiIvx5Mm45WC1z1S57O6O5O8" />
</head>
<body>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="https://smirnov-am.github.io/tags/python">#Python</a>



  
  | <a class="subtitle is-6" href="https://smirnov-am.github.io/tags/pytest">#pytest</a>
  

      
    </div>
    <h2 class="subtitle is-6">September 6, 2020</h2>
    <h1 class="title">Selecting tests with pytest</h1>
    <section class="section" style="padding: 0px 0px;">
    <div class="content has-text-centered" >
        <h2><a href="https://smirnov-am.github.io/modern-web-development-flask">➡️Learn modern Web development with Python and Flask</a></h2>
    </div>
    
</section>
    <div class="content">
      <p>Other pytest articles:</p>
<p><a href="https://smirnov-am.github.io/pytest-why-testing">Why testing is important</a></p>
<p><a href="https://smirnov-am.github.io/pytest-test-types">Types of tests</a></p>
<p><a href="https://smirnov-am.github.io/pytest-tdd">Test driven Development</a></p>
<p><a href="https://smirnov-am.github.io/pytest-hello-world">Hello, World!</a></p>
<p><a href="https://smirnov-am.github.io/pytest-selecting_tests">Selecting tests with pytest</a></p>
<p><a href="https://smirnov-am.github.io/pytest-testing_http_client">Testing HTTP client with pytest</a></p>
<p><a href="https://smirnov-am.github.io/pytest-testing_database">Testing database with pytest</a></p>
<p><a href="https://smirnov-am.github.io/pytest-advanced-fixtures">Advanced fixtures with pytest</a></p>
<p><a href="https://smirnov-am.github.io/pytest-plugins">Pytest plugins</a></p>
<p>Let&rsquo;s add another requirement for our normalize function - it will raise an exception if the number contains a letter, or if a plus sign is not at the beginning.</p>
<p>Now let’s think a bit about the design of the application. Especially about error handling. I assume that our application should have its own exception called <code>NumberValidationException</code>. So the normalize function will raise this exception if a number has a letter.</p>
<p>In order to test if our code raises an exception there is a context manager in pytest that allows that - with <code>pytest.raises</code> and exception.  And a test case with plus sign in the wrong place. Same here - our code should raise an exception.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_number_with_letters</span>():
</span></span><span style="display:flex;"><span>    number <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;+31abc5551234&#39;</span> <span style="color:#75715e"># 1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> pytest<span style="color:#f92672">.</span>raises(NumberValidationException): <span style="color:#75715e"># 2</span>
</span></span><span style="display:flex;"><span>        normalize(number) <span style="color:#75715e"># 3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_number_misplaces_plus</span>():
</span></span><span style="display:flex;"><span>    number <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;+31+5551234&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> pytest<span style="color:#f92672">.</span>raises(NumberValidationException):
</span></span><span style="display:flex;"><span>        normalize(number)
</span></span></code></pre></div><ol>
<li>Input number that we expect to raise an exception</li>
<li>we instruct pytest to check that our code will raise an exception</li>
<li>Code that raises the exception internally</li>
</ol>
<p>The tests fail now as our current implementation doesn&rsquo;t raises anything.
Before fixing that, it’s possible for now just skip this test. For that the test case may be decorated with <code>@pytest.mark.skip</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@pytest</span><span style="color:#f92672">.</span>mark<span style="color:#f92672">.</span>skip
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_number_with_letters</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span></code></pre></div><p>The output of pytest will show that we are skipping tests</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>test_normalize.py ...s.
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> <span style="color:#ae81ff">4</span> passed, <span style="color:#ae81ff">1</span> skipped in 0.04s <span style="color:#f92672">===</span>
</span></span></code></pre></div><p>There is a variation of skip - conditional skip. Let’s skip the test if a environment variable is set.
It&rsquo;s useful when, for example, we skip all integration tests that touch database in an environment without any database available:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@pytest</span><span style="color:#f92672">.</span>mark<span style="color:#f92672">.</span>skipif(os<span style="color:#f92672">.</span>getenv(<span style="color:#e6db74">&#39;SKIP_TEST&#39;</span>), <span style="color:#75715e"># 1</span>
</span></span><span style="display:flex;"><span>                    reason<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;skipping if environment variable is set&#39;</span>) <span style="color:#75715e"># 2</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_number_with_letters</span>(): 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span></code></pre></div><ol>
<li>A skip condition, test is skipped if True</li>
<li>Optional explanation for skipping the test</li>
</ol>
<p>We know that the test fails - so skipping might be a suboptimal option. Another decorator in pytest  - xfail can be used to mark failing cases. It can serve as a reminder that there is a bug in our code that needs to be fixed later.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@pytest</span><span style="color:#f92672">.</span>mark<span style="color:#f92672">.</span>xfail
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_number_with_letters</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span></code></pre></div><p>Output:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>test_normalize.py ...X.
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> <span style="color:#ae81ff">4</span> passed, <span style="color:#ae81ff">1</span> xpassed in 0.04s <span style="color:#f92672">===</span>
</span></span></code></pre></div><p>Sometimes we want to run a single test of a specific subset of test cases.
To run a single test we can pass its name (or it’s part) with a -k option.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>~ pytest . -k spaces
</span></span><span style="display:flex;"><span><span style="color:#f92672">====</span> test session starts <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>collected <span style="color:#ae81ff">5</span> items / <span style="color:#ae81ff">4</span> deselected / <span style="color:#ae81ff">1</span> selected
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test_normalize.py .                                                                                          <span style="color:#f92672">[</span>100%<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> <span style="color:#ae81ff">1</span> passed, <span style="color:#ae81ff">4</span> deselected in 0.04s <span style="color:#f92672">===</span>
</span></span></code></pre></div><p>If we want to create a subset of test cases we can mark them with a mark decorator:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@pytest</span><span style="color:#f92672">.</span>mark<span style="color:#f92672">.</span>exceptions
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_number_with_letters</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span></code></pre></div><p>Then we call pytest with -m option - <code>pytest . -m exceptions</code></p>
<p>Can you finish the normalize function so all the tests are green?</p>
<p>In this unit you&rsquo;ve learned how to select tests, use marks and test exceptions. In the next one you&rsquo;ll learn how to test HTTP client and how to use pytest fixtures.</p>


      
      <div class="related">

<h3>Similar articles:</h3>
<ul>
	
	<li><a href="https://smirnov-am.github.io/pytest-advanced-fixtures/">Advanced fixtures with pytest</a></li>
	
	<li><a href="https://smirnov-am.github.io/pytest-hello-world/">Hello, World!</a></li>
	
	<li><a href="https://smirnov-am.github.io/pytest-plugins/">Pytest plugins</a></li>
	
	<li><a href="https://smirnov-am.github.io/pytest-tdd/">Test driven Development</a></li>
	
	<li><a href="https://smirnov-am.github.io/pytest-testing_http_client/">Testing HTTP client with pytest</a></li>
	
</ul>
</div>
      
    </div>
  </div>
</section>

    <script src="https://smirnov-am.github.io/js/copycode.js"></script>



<section class="section">
  <div class="container has-text-centered">
    <p>&copy; Alexey Smirnov 2021</p>
    
  </div>
</section>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-107429956-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




</body>
</html>

