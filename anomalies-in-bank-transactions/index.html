<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Anomalies in bank transactions</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css?v=48eb5b5f11" />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="canonical" href="https://smirnov-am.github.io/anomalies-in-bank-transactions/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://smirnov-am.github.io/anomalies-in-bank-transactions/amp/" />
    
    <meta property="og:site_name" content="smirnov-am.github.io" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Anomalies in bank transactions" />
    <meta property="og:description" content="Recently I&#x27;ve noticed suspicious transactions in my history that were initiated
by some shady company that provides as the put it &quot;opportunity to shop with
discount&quot; for their subscribers. Some web-shop had small font checkbox that
initiated this subscription. Looks like the whole business model of such
companies based on people who don&#x27;t check their transaction histories often.
Needless to say, there were no subscription confirmation email, monthly bill or
- most importantly - discounts I was s" />
    <meta property="og:url" content="https://smirnov-am.github.io/anomalies-in-bank-transactions/" />
    <meta property="og:image" content="https://smirnov-am.github.io/content/images/2019/08/hand-keyboard-secured-34203.jpg" />
    <meta property="article:published_time" content="2019-08-07T19:03:00.000Z" />
    <meta property="article:modified_time" content="2019-10-23T16:37:45.000Z" />
    <meta property="article:tag" content="machine learning" />
    <meta property="article:tag" content="python" />
    <meta property="article:tag" content="Security" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Anomalies in bank transactions" />
    <meta name="twitter:description" content="Recently I&#x27;ve noticed suspicious transactions in my history that were initiated
by some shady company that provides as the put it &quot;opportunity to shop with
discount&quot; for their subscribers. Some web-shop had small font checkbox that
initiated this subscription. Looks like the whole business model of such
companies based on people who don&#x27;t check their transaction histories often.
Needless to say, there were no subscription confirmation email, monthly bill or
- most importantly - discounts I was s" />
    <meta name="twitter:url" content="https://smirnov-am.github.io/anomalies-in-bank-transactions/" />
    <meta name="twitter:image" content="https://smirnov-am.github.io/content/images/2019/08/hand-keyboard-secured-34203.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Alexey Smirnov" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="machine learning, python, Security" />
    <meta property="og:image:width" content="2000" />
    <meta property="og:image:height" content="1333" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "smirnov-am.github.io",
        "logo": {
            "@type": "ImageObject",
            "url": "https://smirnov-am.github.io/favicon.ico",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Alexey Smirnov",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/f3f61e69a3bdf7419f19cb1be356c0b1?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "https://smirnov-am.github.io/author/alexey/",
        "sameAs": []
    },
    "headline": "Anomalies in bank transactions",
    "url": "https://smirnov-am.github.io/anomalies-in-bank-transactions/",
    "datePublished": "2019-08-07T19:03:00.000Z",
    "dateModified": "2019-10-23T16:37:45.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://smirnov-am.github.io/content/images/2019/08/hand-keyboard-secured-34203.jpg",
        "width": 2000,
        "height": 1333
    },
    "keywords": "machine learning, python, Security",
    "description": "Recently I&#x27;ve noticed suspicious transactions in my history that were initiated\nby some shady company that provides as the put it &quot;opportunity to shop with\ndiscount&quot; for their subscribers. Some web-shop had small font checkbox that\ninitiated this subscription. Looks like the whole business model of such\ncompanies based on people who don&#x27;t check their transaction histories often.\nNeedless to say, there were no subscription confirmation email, monthly bill or\n- most importantly - discounts I was s",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://smirnov-am.github.io/"
    }
}
    </script>

    <meta name="generator" content="Ghost 2.21" />
    <link rel="alternate" type="application/rss+xml" title="smirnov-am.github.io" href="https://smirnov-am.github.io/rss/" />
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-107429956-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-107429956-1');
</script>

</head>
<body class="post-template tag-machine-learning tag-python tag-security">

    <div class="site-wrapper">

        

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
                <a class="site-nav-logo" href="https://smirnov-am.github.io">smirnov-am.github.io</a>
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="https://smirnov-am.github.io/">Home</a></li>
    <li class="nav-github" role="menuitem"><a href="https://github.com/smirnov-am">GitHub</a></li>
    <li class="nav-linkedin" role="menuitem"><a href="https://www.linkedin.com/in/smirnovam/">LinkedIn</a></li>
    <li class="nav-bookshelf" role="menuitem"><a href="https://www.goodreads.com/review/list/100768091-alex-smirnov">Bookshelf</a></li>
</ul>

    </div>
    <div class="site-nav-right">
        <div class="social-links">
        </div>
            <a class="rss-button" href="https://feedly.com/i/subscription/feed/https://smirnov-am.github.io/rss/" title="RSS" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg>
</a>
    </div>
</nav>
    </div>
</header>


<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post tag-machine-learning tag-python tag-security ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="2019-08-07">7 August 2019</time>
                        <span class="date-divider">/</span> <a href="/tag/machine-learning/">machine learning</a>
                </section>
                <h1 class="post-full-title">Anomalies in bank transactions</h1>
            </header>

            <figure class="post-full-image">
                <img
                    srcset="/content/images/size/w300/2019/08/hand-keyboard-secured-34203.jpg 300w,
                            /content/images/size/w600/2019/08/hand-keyboard-secured-34203.jpg 600w,
                            /content/images/size/w1000/2019/08/hand-keyboard-secured-34203.jpg 1000w,
                            /content/images/size/w2000/2019/08/hand-keyboard-secured-34203.jpg 2000w"
                    sizes="(max-width: 800px) 400px,
                            (max-width: 1170px) 700px,
                            1400px"
                    src="/content/images/size/w2000/2019/08/hand-keyboard-secured-34203.jpg"
                    alt="Anomalies in bank transactions"
                />
            </figure>

            <section class="post-full-content">
                <div class="post-content">
                    <p>Recently I've noticed suspicious transactions in my history that were initiated by some shady company that provides as the put it "opportunity to shop with discount" for their subscribers. Some web-shop had small font checkbox that initiated this subscription. Looks like the whole business model of such companies based on people who don't check their transaction histories often. Needless to say, there were no subscription confirmation email, monthly bill or - most importantly - discounts I was supposed to receive.</p><p>After that, I decided to investigate methods to detect suspicious transactions. Of course, banks do that themselves and I'm not supposed to see any in my history. Anyway, I'll cover Low-pass filter, Benford's law, SVM, LOF and IsolationForest.</p><blockquote>Improve Python code quality by running flake8 on pull requests <a href="https://github.com/apps/tongschar">https://github.com/apps/tongschar</a></blockquote><h2 id="input-data">Input data</h2><p>I'm using one of the largest banks in the Netherlands - ABN AMRO. I was able to download transaction history from their online banking platform in Excel format - very nice of them.<br>First of all transaction history contains credits - no need to take them into account. Debits are negative in history, so I convert them to positive numbers.</p><p>The tricky part is a date. There are <code>transactiondate</code> and <code>valuedate</code> columns in history. Also, some transactions have date and time in their description. It may come handy when I'll be doing feature engineering for machine learning. For now, I'll just extract date from <code>transactiondate</code> column  with <code>python-dateutil</code><br>parser. Here is the code to converting export from online banking to the usable dataframe</p><!--kg-card-begin: markdown--><pre><code class="language-python">import pandas as pd
from dateutil.parser import parse

df = pd.read_excel('/home/as/Desktop/abn.xls')
df['date'] = df['transactiondate'].apply(lambda x: parse(str(x)))
df.drop(['accountNumber', 'mutationcode', 'transactiondate',
         'valuedate', 'startsaldo', 'endsaldo'], axis=1, inplace=True)
df['amount'] = df['amount'].apply(abs)
df.set_index('date', inplace=True)
df.head()
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><table>
<thead>
<tr>
<th style="text-align:left">date</th>
<th style="text-align:right">amount</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">2018-06-09 00:00:00</td>
<td style="text-align:right">10</td>
</tr>
<tr>
<td style="text-align:left">2018-06-09 00:00:00</td>
<td style="text-align:right">27.2</td>
</tr>
<tr>
<td style="text-align:left">2018-06-09 00:00:00</td>
<td style="text-align:right">19.04</td>
</tr>
<tr>
<td style="text-align:left">2018-06-09 00:00:00</td>
<td style="text-align:right">36.17</td>
</tr>
<tr>
<td style="text-align:left">2018-06-09 00:00:00</td>
<td style="text-align:right">5.4</td>
</tr>
</tbody>
</table>
<!--kg-card-end: markdown--><h2 id="low-pass-filter">Low-pass filter</h2><p>Now I have a time-series - amount vs date. Applying moving average to is effectively is a low-pass filter that smoothes the series. I've decided to try windows of 7 and 30 days. This running average is not constant and has a standard deviation. And the idea behind this method is to find transactions that more than N standard deviation away from the smoothed line (let N=2).</p><!--kg-card-begin: markdown--><pre><code class="language-python">df['avg_7d'] = df['amount'].rolling('7D').mean()
df['avg_30d'] = df['amount'].rolling('30D').mean()

df['resudual_avg_7d'] = df['amount'] - df['avg_7d']
df['resudual_avg_30d'] = df['amount'] - df['avg_30d']

std_7d = df['resudual_avg_7d'].std()
std_30d = df['resudual_avg_30d'].std()

df['outlier_7d'] = df.apply(lambda row: row['amount'] if abs(row['resudual_avg_7d']) &gt; 2*std_7d else None, axis=1)
df['outlier_30d'] = df.apply(lambda row: row['amount'] if abs(row['resudual_avg_30d']) &gt; 2*std_30d else None, axis=1)
</code></pre>
<!--kg-card-end: markdown--><p>Looks like outliers based on 7D moving average are the same as for 30D window</p><!--kg-card-begin: markdown--><pre><code class="language-python">all((df[(df.outlier_30d &gt; 0) &amp; (df.outlier_7d &gt; 0)]).index == (df[df.outlier_30d &gt; 0]).index)
</code></pre>
<!--kg-card-end: markdown--><p>Let's visualize the time-series and the result. I'm using a log scale because the amounts have order magnitude difference</p><!--kg-card-begin: markdown--><pre><code class="language-python">import plotly
import plotly.graph_objs as go

plotly.offline.init_notebook_mode(connected=True)

data = [go.Scatter(x=df.index, y=df.amount, name='amount', mode = 'markers', marker={'size': 2}),
        go.Scatter(x=df.index, y=df.avg_7d, name='avg 7D'),
        go.Scatter(x=df.index, y=df.avg_30d, name='avg 30D'),
        go.Scatter(x=df.index, y=df.outlier_7d,
                   name='outliers 7D',
                   mode = 'markers',
                   marker = dict(size = 5,
                                 color = 'rgba(152, 0, 0, .8)',
                                 line = dict(width = 2,
                                             color = 'rgb(0, 0, 0)')),
                   text=df.description)]
layout = go.Layout(
    xaxis=dict(
        autorange=True
    ),
    yaxis=dict(
        type='log',
        autorange=True
    )
)
fig = go.Figure(data=data, layout=layout)
plotly.offline.iplot(fig)
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://smirnov-am.github.io/content/images/2019/08/averages.png" class="kg-image"></figure><!--kg-card-end: image--><p>The big red dots show the outliers. They are:</p><p><strong>- </strong>big purchases I've made</p><p><strong>- </strong>rent</p><p><strong>- </strong>1EUR chocolate bars from a wending machine during the week I've spent 10K</p><p>Not much, but at least I've learned how to use <code>plotly</code> here.</p><h2 id="benford-s-law">Benford's law</h2><blockquote>In the 2016 movie The Accountant, Ben Affleck’s character uses Benford’s Law to expose the theft of funds from a robotics company.</blockquote><p>According to that law, a leading significant digit in a series of naturally occurring numbers is likely to be small. There distribution of the first digits in a series of number can be described with a known <a href="https://wikimedia.org/api/rest_v1/media/math/render/svg/26461e7841d135d327aa7d0f914236862e890e7b">formula</a>.</p><p>First I'm going to multiply an amount column by 100, so purchases less than a euro will also participate in the party. Then I'm creating a column with just the first digit of the amount</p><!--kg-card-begin: markdown--><pre><code>df['amount'] = df['amount'].apply(lambda x: 100*x)
df['first_digit'] = df['amount'].apply(lambda x: str(x)[0])
</code></pre>
<!--kg-card-end: markdown--><p>Then I use <code>numpy</code> to get a histogram of the first digits to plot against known distribution.</p><!--kg-card-begin: markdown--><pre><code>import numpy as np
bins = [1,2,3,4,5,6,7,8,9]
count, division = np.histogram(df[&quot;first_digit&quot;], bins=bins, density=True)
</code></pre>
<!--kg-card-end: markdown--><p>The Benford's law distribution</p><!--kg-card-begin: markdown--><pre><code>from math import log10
benford = [log10(1 + 1/d) for d in bins]
</code></pre>
<!--kg-card-end: markdown--><p>Now the visualization:</p><!--kg-card-begin: markdown--><pre><code>data = [go.Bar(x=bins, y=count, name='amount'),
        go.Scatter(x=bins, y=benford, name='Benford law')]
layout = go.Layout(
    xaxis=dict(
        autorange=True
    ),
    yaxis=dict(

        autorange=True
    )
)
fig = go.Figure(data=data, layout=layout)
plotly.offline.iplot(fig)
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://smirnov-am.github.io/content/images/2019/08/benfords.png" class="kg-image"></figure><!--kg-card-end: image--><p>The actual distribution is more or less follows that law. More transactions are starting with 8 and 1. And less starting with 4 and 9. According to Wiki:</p><blockquote>Distributions that would not be expected to obey Benford's Law ... : Where numbers are influenced by human thought: e.g. prices set by psychological thresholds ($1.99)</blockquote><p>Also from this analysis, it's not obvious how to extract suspicious transactions.</p><h2 id="machine-learning-approaches">Machine learning approaches</h2><p>There are a couple of algorithms implemented in <a href="https://scikit-learn.org/0.20/auto_examples/plot_anomaly_comparison.html">scikit-learn</a> for anomaly detection. All of them expect to have a list of samples in some feature space. The above data frame has date column with is not a good feature - it's difficult to use it as a coordinate and calculate distances with it. But it can be used to generate features:</p><p><strong>- </strong>day of the month</p><p><strong>- </strong>day of the week</p><p><strong>- </strong>week of the month (which is just a linear transformation from the day of the month)</p><p>There are also lagging features that can be formed from the amounts:</p><p><strong>- </strong>average of the last X days</p><p><strong>- </strong>value of the amount on T-1 (skip for simplicity)</p><p>So the feature engineering looks like this:</p><!--kg-card-begin: markdown--><pre><code>df['weekday'] = df.apply(lambda row: row.name.weekday(), axis=1)
df['day'] = df.apply(lambda row: row.name.day,  axis=1)
df['prev_amount'] = df['amount'].shift(1)
df.dropna(inplace=True)
</code></pre>
<!--kg-card-end: markdown--><p>The resulted training set:</p><!--kg-card-begin: markdown--><table>
<thead>
<tr>
<th style="text-align:left">date</th>
<th style="text-align:right">amount</th>
<th style="text-align:right">avg_30d</th>
<th style="text-align:right">weekday</th>
<th style="text-align:right">day</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">2018-06-09 00:00:00</td>
<td style="text-align:right">10</td>
<td style="text-align:right">10</td>
<td style="text-align:right">5</td>
<td style="text-align:right">9</td>
</tr>
<tr>
<td style="text-align:left">2018-06-09 00:00:00</td>
<td style="text-align:right">27.2</td>
<td style="text-align:right">18.6</td>
<td style="text-align:right">5</td>
<td style="text-align:right">9</td>
</tr>
<tr>
<td style="text-align:left">2018-06-09 00:00:00</td>
<td style="text-align:right">19.04</td>
<td style="text-align:right">18.7467</td>
<td style="text-align:right">5</td>
<td style="text-align:right">9</td>
</tr>
<tr>
<td style="text-align:left">2018-06-09 00:00:00</td>
<td style="text-align:right">36.17</td>
<td style="text-align:right">23.1025</td>
<td style="text-align:right">5</td>
<td style="text-align:right">9</td>
</tr>
<tr>
<td style="text-align:left">2018-06-09 00:00:00</td>
<td style="text-align:right">5.4</td>
<td style="text-align:right">19.562</td>
<td style="text-align:right">5</td>
<td style="text-align:right">9</td>
</tr>
</tbody>
</table>
<!--kg-card-end: markdown--><p>And as for the most ML algorithms the samples should be scaled to have zero mean, unit variance. But since the samples are having anomalies:</p><blockquote>If your data contains many outliers, scaling using the mean and variance of the data is likely to not work very well. In these cases, you can use <code>robust_scale</code></blockquote><!--kg-card-begin: markdown--><pre><code>from sklearn import preprocessing
X = df[['amount', 'avg_30d', 'weekday', 'day']].values
X = preprocessing.robust_scale(X)
</code></pre>
<!--kg-card-end: markdown--><h2 id="svm">SVM</h2><p>Usually, SVM is used for classification in supervised learning - that is when there is labeled data. SVM finds a hyperplane that acts as a border between classes. There is one algorithm that can be used on unlabelled data - One Class SVM. It finds the smallest hypersphere that the samples allowing for some outliers. The idea is to find a function that is positive for regions with a high density of points, and negative for small densities.<br>One of the hyperparameters of the <code>scikit-learn</code> implementation is <code>nu</code> - the fraction of outliers to expect. I'm putting 5%, but when I've tried default 50% half of the transactions were marked as an outlier.</p><!--kg-card-begin: markdown--><pre><code>from sklearn import svm
outliers_fraction = 0.05
clf = svm.OneClassSVM(nu=outliers_fraction, kernel=&quot;rbf&quot;)
y_pred_outliers = clf.fit_predict(X)
df['outlier_svm'] = y_pred_outliers == -1
</code></pre>
<!--kg-card-end: markdown--><h2 id="lof">LOF</h2><p>Scikit-learn has a clear explanation of the algorithm:</p><blockquote>The anomaly score of each sample is called Local Outlier Factor. It measures the local deviation of density of a given sample with respect to its neighbors. It is local in that the anomaly score depends on how isolated the object is with respect to the surrounding neighborhood. More precisely, locality is given by k-nearest neighbors, whose distance is used to estimate the local density. By comparing the local density of a sample to the local densities of its neighbors, one can identify samples that have a substantially lower density than their neighbors. These are considered outliers.</blockquote><p>The algorithm also except a hyperparameter of how many outliers to detect.</p><!--kg-card-begin: markdown--><pre><code>from sklearn.neighbors import LocalOutlierFactor

clf_lof = LocalOutlierFactor(contamination=outliers_fraction)
y_pred_outliers_lof = clf_lof.fit_predict(X)
df['outlier_lof'] = y_pred_outliers_lof == -1
</code></pre>
<!--kg-card-end: markdown--><h2 id="ensemble">Ensemble</h2><p>The one from ensemble learning algorithms is IsolationForest</p><blockquote>The IsolationForest ‘isolates’ observations by randomly selecting a feature and then randomly selecting a split value between the maximum and minimum values of the selected feature.<br>Since recursive partitioning can be represented by a tree structure, the number of splittings required to isolate a sample is equivalent to the path length from the root node to the terminating node.<br>This path length, averaged over a forest of such random trees, is a measure of normality and our decision function.<br>Random partitioning produces noticeably shorter paths for anomalies. Hence, when a forest of random trees collectively produce shorter path lengths for particular samples, they are highly likely to be anomalies.</blockquote><!--kg-card-begin: markdown--><pre><code>from sklearn.ensemble import IsolationForest

clf_forest = IsolationForest(behaviour=&quot;new&quot;, contamination=outliers_fraction)
y_pred_outliers_forest = clf_forest.fit_predict(X)
df['outlier_forest'] = y_pred_outliers_forest == -1
</code></pre>
<!--kg-card-end: markdown--><h2 id="results">Results</h2><p>One way to display the result is just to show it in time-series:</p><!--kg-card-begin: markdown--><pre><code class="language-python">outliers_svm = df.loc[df['outlier_svm'], ['amount']]
outliers_lof = df.loc[df['outlier_lof'], ['amount']]
outliers_forest = df.loc[df['outlier_forest'], ['amount']]
data = [go.Scatter(x=df.index,
                   y=df.amount,
                   name='amount',
                   mode = 'markers',
                   marker={'size': 2}),
        go.Scatter(x=outliers_svm.index,
                   y=outliers_svm.amount,
                   name='outliers svm',
                   mode = 'markers',
                   marker = dict(size = 5)),
        go.Scatter(x=outliers_lof.index, y=outliers_lof.amount,
                   name='outliers lof',
                   mode = 'markers',
                   marker = dict(symbol=&quot;cross&quot;, size = 5)),
        go.Scatter(x=outliers_forest.index, y=outliers_forest.amount,
                   name='outliers forest',
                   mode = 'markers',
                   marker = dict(symbol=&quot;square-cross&quot;, size = 5, color='red'))
       ]

layout = go.Layout(
    xaxis=dict(
        autorange=True
    ),
    yaxis=dict(
        type='log',
        autorange=True
    )
)
fig = go.Figure(data=data, layout=layout)
plotly.offline.iplot(fig)
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://smirnov-am.github.io/content/images/2019/08/res_t.png" class="kg-image"></figure><!--kg-card-end: image--><p>Another one is to apply dimensionality reduction and plot in simple 2D<br>(maybe it makes sense to do PCA before running classification?)</p><!--kg-card-begin: markdown--><pre><code class="language-python">from sklearn.decomposition import PCA
pca = PCA(n_components=2)
X_two_dim = pca.fit_transform(X)

df2 = pd.DataFrame(X_two_dim, columns=['x', 'y'], index=df.index)
df2['outlier_svm'] = df.outlier_svm
df2['outlier_lof'] = df.outlier_lof
df2['outlier_forest'] = df.outlier_forest

data = [go.Scatter(x=df2.x, y=df2.y, name='amount', mode = 'markers', marker={'size': 2}),
        go.Scatter(x=df2[df2.outlier_svm == 1].x, y=df2[df2.outlier_svm == 1].y, name='outlier_svm', mode = 'markers', marker={'size': 5}),
        go.Scatter(x=df2[df2.outlier_lof == 1].x, y=df2[df2.outlier_lof == 1].y, name='outlier_lof', mode = 'markers', marker={'size': 5}),
        go.Scatter(x=df2[df2.outlier_forest == 1].x, y=df2[df2.outlier_forest == 1].y, name='outlier_forest', mode = 'markers', marker={'size': 5}),
       ]

layout = go.Layout(
    xaxis=dict(
                type='log',
        autorange=True
    ),
    yaxis=dict(

        autorange=True
    )
)
fig = go.Figure(data=data, layout=layout)
plotly.offline.iplot(fig)
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://smirnov-am.github.io/content/images/2019/08/newplot.png" class="kg-image"></figure><!--kg-card-end: image--><p>Of course, these algorithms are not an end-to-end solution for fraud detection in bank transactions. There are much more signals that can be used</p><p><strong>- </strong>whether a transaction was done from a terminal or online bank</p><p><strong>- </strong>if the recipient of the transaction a known account</p><p><strong>- </strong>where was the transaction was made - in or outside of  the country</p><p>Also, they failed to find the transactions from the introduction to this post. But to solve that problem I'm building an <a href="https://afplakkenonline.nl/">app</a>. </p>
                </div>
            </section>


            <footer class="post-full-footer">


                    
<section class="author-card">
        <img class="author-profile-image" src="//www.gravatar.com/avatar/f3f61e69a3bdf7419f19cb1be356c0b1?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x" alt="Alexey Smirnov" />
    <section class="author-card-content">
        <h4 class="author-card-name"><a href="/author/alexey/">Alexey Smirnov</a></h4>
            <p>Read <a href="/author/alexey/">more posts</a> by this author.</p>
    </section>
</section>
<div class="post-full-footer-right">
    <a class="author-card-button" href="/author/alexey/">Read More</a>
</div>


            </footer>


        </article>

    </div>
</main>

<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
                <article class="read-next-card"

                >
                    <header class="read-next-card-header">
                        <small class="read-next-card-header-sitetitle">&mdash; smirnov-am.github.io &mdash;</small>
                        <h3 class="read-next-card-header-title"><a href="/tag/machine-learning/">machine learning</a></h3>
                    </header>
                    <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                    <div class="read-next-card-content">
                        <ul>
                            <li><a href="/extracting-keyphrases-from-texts-unsupervised-algorithm-topicrank/">Extracting keyphrases from texts: unsupervised algorithm TopicRank</a></li>
                            <li><a href="/2018-04-08-e-commerce-recommendation-systems-html/">E-commerce recommendation systems: basket analysis. Performance comparison of most common algorithms.</a></li>
                        </ul>
                    </div>
                    <footer class="read-next-card-footer">
                        <a href="/tag/machine-learning/">See all 2 posts →</a>
                    </footer>
                </article>

                <article class="post-card post tag-aws tag-python ">

    <a class="post-card-image-link" href="/ci-ci-pipeline-for-aws-lambda-python-runtime/">
        <img class="post-card-image"
            srcset="/content/images/size/w300/2019/08/quinten-de-graaf-L4gN0aeaPY4-unsplash.jpg 300w,
                    /content/images/size/w600/2019/08/quinten-de-graaf-L4gN0aeaPY4-unsplash.jpg 600w,
                    /content/images/size/w1000/2019/08/quinten-de-graaf-L4gN0aeaPY4-unsplash.jpg 1000w,
                    /content/images/size/w2000/2019/08/quinten-de-graaf-L4gN0aeaPY4-unsplash.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 700px"
            src="/content/images/size/w600/2019/08/quinten-de-graaf-L4gN0aeaPY4-unsplash.jpg"
            alt="CI/CD  pipeline for AWS Lambda (Python runtime)"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/ci-ci-pipeline-for-aws-lambda-python-runtime/">

            <header class="post-card-header">
                    <span class="post-card-tags">AWS</span>
                <h2 class="post-card-title">CI/CD  pipeline for AWS Lambda (Python runtime)</h2>
            </header>

            <section class="post-card-excerpt">
                <p>Continuous integration and continuous delivery are powerful practices that allow release software faster and of a higher quality. I'm going to walk through steps to implement CI/CD pipeline for a small lambda</p>
            </section>

        </a>

        <footer class="post-card-meta">

            <ul class="author-list">
                <li class="author-list-item">

                    <div class="author-name-tooltip">
                        Alexey Smirnov
                    </div>

                        <a href="/author/alexey/" class="static-avatar">
                            <img class="author-profile-image" src="//www.gravatar.com/avatar/f3f61e69a3bdf7419f19cb1be356c0b1?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x" alt="Alexey Smirnov" />
                        </a>
                </li>
            </ul>

            <span class="reading-time">4 min read</span>

        </footer>

    </div>

</article>

                <article class="post-card post tag-financial-modelling tag-python ">

    <a class="post-card-image-link" href="/calculating-enterprise-value-with-python-and-pandas-part-1-wacc-and-dcf/">
        <img class="post-card-image"
            srcset="/content/images/size/w300/2019/07/phyton-i-reka.png 300w,
                    /content/images/size/w600/2019/07/phyton-i-reka.png 600w,
                    /content/images/size/w1000/2019/07/phyton-i-reka.png 1000w,
                    /content/images/size/w2000/2019/07/phyton-i-reka.png 2000w"
            sizes="(max-width: 1000px) 400px, 700px"
            src="/content/images/size/w600/2019/07/phyton-i-reka.png"
            alt="Calculating enterprise value with Python and Pandas (part 2). WACC and DCF"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/calculating-enterprise-value-with-python-and-pandas-part-1-wacc-and-dcf/">

            <header class="post-card-header">
                    <span class="post-card-tags">Financial Modelling</span>
                <h2 class="post-card-title">Calculating enterprise value with Python and Pandas (part 2). WACC and DCF</h2>
            </header>

            <section class="post-card-excerpt">
                <p>The weighted average cost of capital (WACC) is used as the discount rate for a firm’s anticipated free cash flows (FCFs)The formula is the following:whereE = market value of the firm’</p>
            </section>

        </a>

        <footer class="post-card-meta">

            <ul class="author-list">
                <li class="author-list-item">

                    <div class="author-name-tooltip">
                        Alexey Smirnov
                    </div>

                        <a href="/author/alexey/" class="static-avatar">
                            <img class="author-profile-image" src="//www.gravatar.com/avatar/f3f61e69a3bdf7419f19cb1be356c0b1?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x" alt="Alexey Smirnov" />
                        </a>
                </li>
            </ul>

            <span class="reading-time">4 min read</span>

        </footer>

    </div>

</article>

        </div>
    </div>
</aside>

<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://smirnov-am.github.io">
            <span>smirnov-am.github.io</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Anomalies in bank transactions</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-fb" href="https://www.linkedin.com/shareArticle?url=https://smirnov-am.github.io/anomalies-in-bank-transactions/&title=Anomalies%20in%20bank%20transactions" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
width="26" height="26"
viewBox="0 0 192 192"
style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,192v-192h192v192z" fill="none"></path><g fill="#ffffff"><g id="surface1"><path d="M156,0h-120c-19.875,0 -36,16.125 -36,36v120c0,19.875 16.125,36 36,36h120c19.875,0 36,-16.125 36,-36v-120c0,-19.875 -16.125,-36 -36,-36zM59.36539,162.98077h-29.82693l-0.17307,-89.30769h29.82692zM43.70192,61.99038h-0.17308c-9.75,0 -16.03846,-6.72115 -16.03846,-15.08653c0,-8.56731 6.49039,-15.0577 16.41347,-15.0577c9.92308,0 16.00961,6.49038 16.21153,15.0577c0,8.36538 -6.31731,15.08653 -16.41346,15.08653zM162.77885,162.98077h-30.08654v-48.51923c0,-11.74039 -3.11538,-19.73077 -13.61538,-19.73077c-8.01923,0 -12.34615,5.39423 -14.42308,10.61538c-0.77885,1.875 -0.98077,4.44231 -0.98077,7.06731v50.56731h-30.23077l-0.17308,-89.30769h30.23077l0.17308,12.60577c3.86538,-5.97116 10.29808,-14.42308 25.70192,-14.42308c19.09616,0 33.37501,12.46154 33.37501,39.25961v51.86539z"></path></g></g></g></svg>
</a>
        <a class="floating-header-share-tw" href="http://www.reddit.com/submit?url=https://smirnov-am.github.io/anomalies-in-bank-transactions/&title=Anomalies%20in%20bank%20transactions" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M14.238 15.348c.085.084.085.221 0 .306-.465.462-1.194.687-2.231.687l-.008-.002-.008.002c-1.036 0-1.766-.225-2.231-.688-.085-.084-.085-.221 0-.305.084-.084.222-.084.307 0 .379.377 1.008.561 1.924.561l.008.002.008-.002c.915 0 1.544-.184 1.924-.561.085-.084.223-.084.307 0zm-3.44-2.418c0-.507-.414-.919-.922-.919-.509 0-.923.412-.923.919 0 .506.414.918.923.918.508.001.922-.411.922-.918zm13.202-.93c0 6.627-5.373 12-12 12s-12-5.373-12-12 5.373-12 12-12 12 5.373 12 12zm-5-.129c0-.851-.695-1.543-1.55-1.543-.417 0-.795.167-1.074.435-1.056-.695-2.485-1.137-4.066-1.194l.865-2.724 2.343.549-.003.034c0 .696.569 1.262 1.268 1.262.699 0 1.267-.566 1.267-1.262s-.568-1.262-1.267-1.262c-.537 0-.994.335-1.179.804l-2.525-.592c-.11-.027-.223.037-.257.145l-.965 3.038c-1.656.02-3.155.466-4.258 1.181-.277-.255-.644-.415-1.05-.415-.854.001-1.549.693-1.549 1.544 0 .566.311 1.056.768 1.325-.03.164-.05.331-.05.5 0 2.281 2.805 4.137 6.253 4.137s6.253-1.856 6.253-4.137c0-.16-.017-.317-.044-.472.486-.261.82-.766.82-1.353zm-4.872.141c-.509 0-.922.412-.922.919 0 .506.414.918.922.918s.922-.412.922-.918c0-.507-.413-.919-.922-.919z"/></svg></a>
        <a class="floating-header-share-fb" href="https://news.ycombinator.com/submitlink?u=https://smirnov-am.github.io/anomalies-in-bank-transactions/&t=Anomalies%20in%20bank%20transactions" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
width="100" height="100"
viewBox="0 0 50 50"
style=" fill:#000000;">    <path d="M 4 4 L 4 5 L 4 46 L 46 46 L 46 4 L 4 4 z M 6 6 L 44 6 L 44 44 L 6 44 L 6 6 z M 12.652344 13 L 14.238281 15.947266 L 21 28.503906 L 21 36 L 21 38 L 23 38 L 27 38 L 29 38 L 29 36 L 29 28.503906 L 35.761719 15.947266 L 37.347656 13 L 34 13 L 30.824219 13 L 29.664062 13 L 29.087891 14.007812 L 25 21.158203 L 20.912109 14.007812 L 20.337891 13 L 19.177734 13 L 16 13 L 12.652344 13 z M 16 15 L 19.175781 15 L 25 25.1875 L 30.824219 15 L 34 15 L 27 28 L 27 36 L 23 36 L 23 28 L 16 15 z"></path></svg></a>
    </div>
    <progress id="reading-progress" class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>




        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://smirnov-am.github.io">smirnov-am.github.io</a> &copy; 2019</section>
                <nav class="site-footer-nav">
                    <a href="https://smirnov-am.github.io">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>


    <script>
        var images = document.querySelectorAll('.kg-gallery-image img');
        images.forEach(function (image) {
            var container = image.closest('.kg-gallery-image');
            var width = image.attributes.width.value;
            var height = image.attributes.height.value;
            var ratio = width / height;
            container.style.flex = ratio + ' 1 0%';
        })
    </script>


    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/built/jquery.fitvids.js?v=48eb5b5f11"></script>


    <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('#reading-progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();

});
</script>


    testsetset

</body>
</html>
