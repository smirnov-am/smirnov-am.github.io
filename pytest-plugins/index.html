<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https:\/\/smirnov-am.github.io"
        },
        "articleSection" : "post",
        "name" : "Pytest plugins",
        "headline" : "Pytest plugins",
        "description" : "Other pytest articles:\nWhy testing is important\nTypes of tests\nTest driven Development\nHello, World!\nSelecting tests with pytest\nTesting HTTP client with pytest\nTesting database with pytest\nAdvanced fixtures with pytest\nPytest plugins\nThere are lot of plugins in pytest ecosystem. Some of the widely used are listed here All the plugins can be installed with pip and invoked by providing an argument to pytest executable.\npytest-cov This plugin calculates test coverage - how much of our code is covered by test.",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2020",
        "datePublished": "2020-09-06 18:41:00 \x2b0000 UTC",
        "dateModified" : "2020-09-06 18:41:00 \x2b0000 UTC",
        "url" : "https:\/\/smirnov-am.github.io\/pytest-plugins\/",
        "wordCount" : "514",
        "keywords" : [ "Python","pytest","Blog" ]
    }
    </script>

<title>Pytest plugins | Alexey Smirnov</title>

<meta property='og:title' content='Pytest plugins - Alexey Smirnov'>
<meta property='og:description' content='Other pytest articles:
Why testing is important
Types of tests
Test driven Development
Hello, World!
Selecting tests with pytest
Testing HTTP client with pytest
Testing database with pytest
Advanced fixtures with pytest
Pytest plugins
There are lot of plugins in pytest ecosystem. Some of the widely used are listed here All the plugins can be installed with pip and invoked by providing an argument to pytest executable.
pytest-cov This plugin calculates test coverage - how much of our code is covered by test.'>
<meta property='og:url' content='https://smirnov-am.github.io/pytest-plugins/'>
<meta property='og:site_name' content='Alexey Smirnov'>
<meta property='og:type' content='article'><meta property='og:image' content='https://www.gravatar.com/avatar/f3f61e69a3bdf7419f19cb1be356c0b1?s=256'><meta property='article:section' content='Post'><meta property='article:tag' content='Python'><meta property='article:tag' content='pytest'><meta property='article:published_time' content='2020-09-06T18:41:00Z'/><meta property='article:modified_time' content='2020-09-06T18:41:00Z'/><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@'><meta name='twitter:creator' content='@'>


<link href="https://smirnov-am.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Alexey Smirnov" />

<link rel="stylesheet" href="https://smirnov-am.github.io/css/style.css"/><link rel="apple-touch-icon" sizes="180x180" href="https://smirnov-am.github.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://smirnov-am.github.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://smirnov-am.github.io/favicon-16x16.png">
<link rel="manifest" href="https://smirnov-am.github.io/site.webmanifest">
<link rel="mask-icon" href="https://smirnov-am.github.io/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://smirnov-am.github.io/pytest-plugins/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<meta name="google-site-verification" content="LxHvTgaBdcBpIRtJMFKFiIvx5Mm45WC1z1S57O6O5O8" />
</head>
<body>
<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://smirnov-am.github.io">
          <h1 id="nav-heading" class="title is-4">Alexey Smirnov</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/smirnov-am'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
  
</svg></i>
            </span>
          </a><a class="level-item" aria-label="linkedin" href='https://linkedin.com/in/smirnovam'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path stroke-width="1.8" d="m5.839218,4.101561c0,1.211972 -0.974141,2.194011 -2.176459,2.194011s-2.176459,-0.982039 -2.176459,-2.194011c0,-1.211094 0.974141,-2.194011 2.176459,-2.194011s2.176459,0.982917 2.176459,2.194011zm0.017552,3.94922l-4.388022,0l0,14.04167l4.388022,0l0,-14.04167zm7.005038,0l-4.359939,0l0,14.04167l4.360816,0l0,-7.370999c0,-4.098413 5.291077,-4.433657 5.291077,0l0,7.370999l4.377491,0l0,-8.89101c0,-6.915523 -7.829986,-6.66365 -9.669445,-3.259423l0,-1.891237z"/>
  
</svg></i>
            </span>
          </a><a class="level-item" aria-label="youtube" href='https://youtube.com/channel/UC1PS5Vov2HSkz-fKCQUiffg'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"/>
  <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"/>
  
</svg></i>
            </span>
          </a><a class="level-item" aria-label="email" href='mailto:msc.smirnov.am@gmail.com'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
  <polyline points="22,6 12,13 2,6"/>
  
</svg></i>
            </span>
          </a><a class="level-item" aria-label="rss" href='https://smirnov-am.github.io/index.xml'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
  
</svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
  <script src="https://smirnov-am.github.io/js/navicon-shift.js"></script>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="https://smirnov-am.github.io/tags/python">#Python</a>



  
  | <a class="subtitle is-6" href="https://smirnov-am.github.io/tags/pytest">#pytest</a>
  

      
    </div>
    <h2 class="subtitle is-6">September 6, 2020</h2>
    <h1 class="title">Pytest plugins</h1>
    
    <div class="content">
      

<p>Other pytest articles:</p>

<p><a href="https://smirnov-am.github.io/pytest-why-testing">Why testing is important</a></p>

<p><a href="https://smirnov-am.github.io/pytest-test-types">Types of tests</a></p>

<p><a href="https://smirnov-am.github.io/pytest-tdd">Test driven Development</a></p>

<p><a href="https://smirnov-am.github.io/pytest-hello-world">Hello, World!</a></p>

<p><a href="https://smirnov-am.github.io/pytest-selecting_tests">Selecting tests with pytest</a></p>

<p><a href="https://smirnov-am.github.io/pytest-testing_http_client">Testing HTTP client with pytest</a></p>

<p><a href="https://smirnov-am.github.io/pytest-testing_database">Testing database with pytest</a></p>

<p><a href="https://smirnov-am.github.io/pytest-advanced-fixtures">Advanced fixtures with pytest</a></p>

<p><a href="https://smirnov-am.github.io/pytest-plugins">Pytest plugins</a></p>

<p>There are lot of plugins in pytest ecosystem. Some of the widely used are listed <a href="https://docs.pytest.org/en/5.4.3/plugins.html?highlight=plugins#installing-and-using-plugins" target="_blank">here</a>
All the plugins can be installed with pip and invoked by providing an argument to pytest executable.</p>

<h2 id="pytest-cov">pytest-cov</h2>

<p>This plugin calculates test coverage - how much of our code is covered by test. Since every project is unique it&rsquo;s difficult to tell an universally acceptable coverage (<a href="https://www.artima.com/forums/flat.jsp?forum=106&amp;thread=204677" target="_blank">https://www.artima.com/forums/flat.jsp?forum=106&amp;thread=204677</a>)</p>

<p>If we have all out source files in  <code>source/</code> folder and test in <code>test/</code> then we can run pytest with this plugin by</p>

<pre><code class="language-bash">pytest --cov=&quot;source&quot; --cov-report=term-missing test/
</code></pre>

<p>cov-report argument will determine what report to generate.  <code>term-missing</code> report will tell exactly which lines are not covered by tests.</p>

<p>The output report looks like this</p>

<pre><code class="language-bash">--- coverage: python 3.6.2-final-0 ---
Name                       Stmts   Miss  Cover   Missing
------------------------------------------------
source/__init__.py             0      0   100%
source/api.py                 12      4    67%   10-11, 15-16
source/database.py            15      0   100%
source/exceptions.py           2      0   100%
source/nnormalize.py          14      4    71%   6-9
source/number_checker.py       8      0   100%
------------------------------------------------
TOTAL                         51      8    84%
</code></pre>

<h2 id="pytest-xdist">pytest-xdist</h2>

<p>This plugin will parallelize test execution. It will speed up executing of large test sets.</p>

<pre><code class="language-bash">pytest -n 5 test/
</code></pre>

<p>Where 5 is a number of workers. It can also accept <code>auto</code> as a parameter. The pytest output is not changed when using this plugin (except some hint that it&rsquo;s running multiple processes)</p>

<h2 id="pytest-bdd">pytest-bdd</h2>

<p>This is a less technical plugin of the three I wanted to cover. This one allows to convert feature files written in Gherkin format to pytest cases.</p>

<p>We start working with pytest-bdd by creating a feature file in a <a href="https://cucumber.io/docs/gherkin/" target="_blank">Gherkin</a> format. This is a highly readable form to describe a feature or a user story and to fix business-side requirements.</p>

<pre><code class="language-gherkin">Feature: Phone number validation application

    Scenario: validate a number
        Given I have a number +311234555
        When I run number validation application
        Then Number is normalized 
        And Cache is checked for presence of this number
        And External API is called if cache doesn't contains the number 
</code></pre>

<p>With this file we can generate our test case:</p>

<pre><code class="language-bash">pytest-bdd generate validation.feature &gt;&gt; test_number_validation.py
</code></pre>

<p>Test file appears to be pretty long, but here is some main points:
- there is a functions decorated with <code>given</code>, <code>when</code>, <code>then</code> decorators from pytest-bdd like</p>

<pre><code class="language-python">@given('I have a number +311234555')
def i_have_a_number_311234555():
    &quot;&quot;&quot;I have a number +311234555.&quot;&quot;&quot;
    raise NotImplementedError
</code></pre>

<ul>
<li>the decorator input string is what we have written in a feature file</li>

<li><p>functions decorated with @given are recognized as fixtures, so they can be passed to a last function, decorated with <code>@then</code></p>

<pre><code class="language-python">@given('I have a number +311234555')
def i_have_a_number_311234555():
&quot;&quot;&quot;I have a number +311234555.&quot;&quot;&quot;
return '+311234555'

@when('I run number validation application')
def i_run_number_validation_application(i_have_a_number_311234555):
# do stuff and use 
# i_have_a_number_311234555 holding out test number
raise NotImplementedError
</code></pre></li>
</ul>

<p>This might look like an unnecessary extra step, but some organizations find it useful to fix business requirements.</p>

<p>This is the last unit in this course. Thanks for staying with me and I hope that you find this content valuable.</p>

      
      <div class="related">

<h3>Similar articles:</h3>
<ul>
	
	<li><a href="https://smirnov-am.github.io/pytest-advanced-fixtures/">Advanced fixtures with pytest</a></li>
	
	<li><a href="https://smirnov-am.github.io/pytest-hello-world/">Hello, World!</a></li>
	
	<li><a href="https://smirnov-am.github.io/pytest-selecting_tests/">Selecting tests with pytest</a></li>
	
	<li><a href="https://smirnov-am.github.io/pytest-tdd/">Test driven Development</a></li>
	
	<li><a href="https://smirnov-am.github.io/pytest-testing_http_client/">Testing HTTP client with pytest</a></li>
	
</ul>
</div>
      
    </div>
    
  </div>
</section>

    <script src="https://smirnov-am.github.io/js/copycode.js"></script>



<section class="section">
  <div class="container has-text-centered">
    <p>&copy; Alexey Smirnov 2020</p>
    
  </div>
</section>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-107429956-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




</body>
</html>

