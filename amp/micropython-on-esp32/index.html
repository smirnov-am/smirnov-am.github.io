<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https:\/\/smirnov-am.github.io"
        },
        "articleSection" : "post",
        "name" : "Installing MicroPython on ESP32",
        "headline" : "Installing MicroPython on ESP32",
        "description" : "Python vs MicroPython MicroPython is an implementation of Python interpreter that can run on non x86 processors. One the hardware platforms that MicroPython supports is ESP32.\nMicroPython is implemented using ESP-IDF, which is a framework provided by the manufacturer of the ESP32. ESP-IDF is based on FreeRTOS - real-time operating system kernel.\nBoards ESP32 system - containing CPU\/WiFi\/BT - comes in many different flavors. The chip itself also can come pre-installed on a board - like ESP32-DevKitC.",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2019",
        "datePublished": "2019-12-29 17:03:00 \x2b0000 UTC",
        "dateModified" : "2019-12-29 17:03:00 \x2b0000 UTC",
        "url" : "https:\/\/smirnov-am.github.io\/amp\/micropython-on-esp32\/",
        "wordCount" : "755",
        "keywords" : [ "MicroPython","Python","Embedded","ESP32","Blog" ]
    }
    </script>

<title>Installing MicroPython on ESP32 | Alexey Smirnov</title>

<meta property='og:title' content='Installing MicroPython on ESP32 - Alexey Smirnov'>
<meta property='og:description' content='Python vs MicroPython MicroPython is an implementation of Python interpreter that can run on non x86 processors. One the hardware platforms that MicroPython supports is ESP32.
MicroPython is implemented using ESP-IDF, which is a framework provided by the manufacturer of the ESP32. ESP-IDF is based on FreeRTOS - real-time operating system kernel.
Boards ESP32 system - containing CPU/WiFi/BT - comes in many different flavors. The chip itself also can come pre-installed on a board - like ESP32-DevKitC.'>
<meta property='og:url' content='https://smirnov-am.github.io/amp/micropython-on-esp32/'>
<meta property='og:site_name' content='Alexey Smirnov'>
<meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='MicroPython'><meta property='article:tag' content='Python'><meta property='article:tag' content='Embedded'><meta property='article:tag' content='ESP32'><meta property='article:published_time' content='2019-12-29T17:03:00Z'/><meta property='article:modified_time' content='2019-12-29T17:03:00Z'/><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@'><meta name='twitter:creator' content='@'>


<link href="https://smirnov-am.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Alexey Smirnov" />

<link rel="stylesheet" href="https://smirnov-am.github.io/css/style.css"/><link rel="apple-touch-icon" sizes="180x180" href="https://smirnov-am.github.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://smirnov-am.github.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://smirnov-am.github.io/favicon-16x16.png">
<link rel="manifest" href="https://smirnov-am.github.io/site.webmanifest">
<link rel="mask-icon" href="https://smirnov-am.github.io/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://smirnov-am.github.io/amp/micropython-on-esp32/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<meta name="google-site-verification" content="LxHvTgaBdcBpIRtJMFKFiIvx5Mm45WC1z1S57O6O5O8" />
</head>
<body>
<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://smirnov-am.github.io">
          <h1 id="nav-heading" class="title is-4">Alexey Smirnov</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/smirnov-am'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="linkedin" href='https://linkedin.com/in/smirnovam'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path stroke-width="1.8" d="m5.839218,4.101561c0,1.211972 -0.974141,2.194011 -2.176459,2.194011s-2.176459,-0.982039 -2.176459,-2.194011c0,-1.211094 0.974141,-2.194011 2.176459,-2.194011s2.176459,0.982917 2.176459,2.194011zm0.017552,3.94922l-4.388022,0l0,14.04167l4.388022,0l0,-14.04167zm7.005038,0l-4.359939,0l0,14.04167l4.360816,0l0,-7.370999c0,-4.098413 5.291077,-4.433657 5.291077,0l0,7.370999l4.377491,0l0,-8.89101c0,-6.915523 -7.829986,-6.66365 -9.669445,-3.259423l0,-1.891237z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="rss" href='https://smirnov-am.github.io/index.xml'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
  <section class="section">
    <div class="container has-text-centered" style="background-color: lightcyan;">
      <p>Join my free email course <a href="https://app.emailcourse.net/testing-python-code-with-pytest">Testing Python code with pytest</a></p>
    </div>
  </section>
  <script src="https://smirnov-am.github.io/js/navicon-shift.js"></script>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="https://smirnov-am.github.io/tags/micropython">#MicroPython</a>



  
  | <a class="subtitle is-6" href="https://smirnov-am.github.io/tags/python">#Python</a>
  
  | <a class="subtitle is-6" href="https://smirnov-am.github.io/tags/embedded">#Embedded</a>
  
  | <a class="subtitle is-6" href="https://smirnov-am.github.io/tags/esp32">#ESP32</a>
  

      
    </div>
    <h2 class="subtitle is-6">December 29, 2019</h2>
    <h1 class="title">Installing MicroPython on ESP32</h1>
    
    <div class="content">
      

<h2 id="python-vs-micropython">Python vs MicroPython</h2>

<p>MicroPython is an implementation of Python interpreter that can run on non x86 processors.
One the hardware platforms that MicroPython supports is <a href="https://en.wikipedia.org/wiki/ESP32" target="_blank">ESP32</a>.</p>

<p>MicroPython is implemented using ESP-IDF, which is a framework provided by the manufacturer
of the ESP32. ESP-IDF is based on FreeRTOS - real-time operating system kernel.</p>

<p><img src="https://smirnov-am.github.io/content/images/micropython-esp32-img/esp32.png" alt="esp32" /></p>

<h2 id="boards">Boards</h2>

<p>ESP32 system - containing CPU/WiFi/BT - comes in many different flavors. The chip itself
also can come pre-installed on a board - like ESP32-DevKitC. Such boards have USB port and easy access to the inputs and outputs of the system</p>

<p><img src="https://smirnov-am.github.io/content/images/micropython-esp32-img/board.jpeg" alt="board" /></p>

<h2 id="connecting-the-board-to-mac">Connecting the board to MAC</h2>

<p>When the board is connected to the MAC using a USB port its identified as USB-to-Serial converter. For that special drivers should <a href="https://docs.espressif.com/projects/esp-idf/en/latest/get-started/establish-serial-connection.html" target="_blank">be installed</a>.
My board needs CP210x driver. The installation is pretty straightforward. As the result, when the board is connected and the driver is installed we can check if the connection is established by listing the identified serial devices</p>

<pre><code>mac:~ as$ ls -l /dev/cu*
crw-rw-rw-  1 root  wheel   19,   1 Dec 19 20:28 /dev/cu.Bluetooth-Incoming-Port
crw-rw-rw-  1 root  wheel   19,   5 Dec 26 18:15 /dev/cu.SLAB_USBtoUART
</code></pre>

<p><code>/dev/cu.SLAB_USBtoUART</code> is the devices we will use later</p>

<h2 id="install-esptools">Install esptools</h2>

<p><a href="https://github.com/espressif/esptool" target="_blank">esptools</a> is CLI tool we will use to burn MicroPython binaries on the system&rsquo;s flash.
It can be installed system-wide my MAC has python2 as default:</p>

<pre><code class="language-bash">mac:~ as$ python -V
Python 2.7.10
mac:~ as$ pip install esptool
....
Successfully installed ecdsa-0.14.1 esptool-2.8 pyaes-1.6.1

mac:~ as$ esptool.py -h
usage: esptool [-h] [--chip {auto,esp8266,esp32}] [--port PORT] [--baud BAUD]
               [--before {default_reset,no_reset,no_reset_no_sync}]
               [--after {hard_reset,soft_reset,no_reset}] [--no-stub]
               [--trace] [--override-vddsdio [{1.8V,1.9V,OFF}]]
               {load_ram,dump_mem,read_mem,write_mem,write_flash,run,image_info,make_image,elf2image,read_mac,chip_id,flash_id,read_flash_status,write_flash_status,read_flash,verify_flash,erase_flash,erase_region,version}
               ...
</code></pre>

<p>It can be installed inside virtualsenv using python3 as well.</p>

<h2 id="get-micropython">Get MicroPython</h2>

<p>MicroPython binaries can be downloaded from this <a href="https://micropython.org/download#esp32" target="_blank">link</a>.
I&rsquo;m using generic idf4 version with my board:</p>

<p><img src="https://smirnov-am.github.io/content/images/micropython-esp32-img/mp_fw.png" alt="" /></p>

<h2 id="burn-micropython">Burn MicroPython</h2>

<p>First the existing data on the flash should be erased. Here we need to reference to the serial device from p.1</p>

<pre><code class="language-bash">mac:~ as$ esptool.py --chip esp32 --port /dev/cu.SLAB_USBtoUART erase_flash
esptool.py v2.8
Serial port /dev/cu.SLAB_USBtoUART
Connecting........_____....._
Chip is ESP32D0WDQ5 (revision 1)
Features: WiFi, BT, Dual Core, 240MHz, VRef calibration in efuse, Coding Scheme None
Crystal is 40MHz
MAC: 84:0d:8e:e6:5e:14
Uploading stub...
Running stub...
Stub running...
Erasing flash (this may take a while)...
Chip erase completed successfully in 9.2s
Hard resetting via RTS pin...
</code></pre>

<p>Then the downloaded firmware is burned:</p>

<pre><code class="language-bash">mac:~ as$ esptool.py --chip esp32 --port /dev/cu.SLAB_USBtoUART --baud 460800 write_flash -z 0x1000 ~/Downloads/esp32-idf4-20191226-v1.12-5-g42e45bd69.bin
esptool.py v2.8
Serial port /dev/cu.SLAB_USBtoUART
Connecting........__
Chip is ESP32D0WDQ5 (revision 1)
Features: WiFi, BT, Dual Core, 240MHz, VRef calibration in efuse, Coding Scheme None
Crystal is 40MHz
MAC: 84:0d:8e:e6:5e:14
Uploading stub...
Running stub...
Stub running...
Changing baud rate to 460800
Changed.
Configuring flash size...
Auto-detected Flash size: 4MB
Compressed 1408544 bytes to 894670...
Wrote 1408544 bytes (894670 compressed) at 0x00001000 in 21.0 seconds (effective 536.9 kbit/s)...
Hash of data verified.

Leaving...
Hard resetting via RTS pin...
</code></pre>

<h2 id="use-ide">Use IDE</h2>

<p>PyCharm has a MicroPython plugin, but according to the description it doesn&rsquo;t support ESP32 yet. Another IDE option is <a href="http://docs.dfrobot.com/upycraft/" target="_blank">uPyCraft</a>. It&rsquo;s in it&rsquo;s early stages, but it works pretty well with ESP32.</p>

<p>When installed and launched we need to select a serial device used to connect to the board in Tools -&gt; Serial.</p>

<p><img src="https://smirnov-am.github.io/content/images/micropython-esp32-img/tools-serial.png" alt="serial" /></p>

<p>Then we can create a python script to turn the lad on and off. For that a local file is created first with <code>File -&gt; New</code>.
When saved with <code>File -&gt; Save</code> uPyCraft prompts for a filename. Let&rsquo;s name it blink.py.  It&rsquo;s saved locally and in order to upload it we can drag it from <code>workspace</code> directory to the <code>device</code> directory. The icon of the files changes to a square showing that it&rsquo;s on hte device&rsquo;s flash:</p>

<p><img src="https://smirnov-am.github.io/content/images/micropython-esp32-img/file_device.png" alt="file" /></p>

<p>After that we need to tell the board to use that file by <code>right-click -&gt; Default Run</code></p>

<p><img src="https://smirnov-am.github.io/content/images/micropython-esp32-img/default_run.png" alt="defrun" /></p>

<h1 id="connect-the-led">Connect the LED</h1>

<p>I&rsquo;m using pin 27 as an output pin in the code. It will give 3.3V when powered by connected USB and 12mA of current can be drawn. I&rsquo;m using this <a href="http://www.ohmslawcalculator.com/led-resistor-calculator" target="_blank">calculator</a> to get the resistor value.</p>

<p>My setup looks like this:</p>

<p><img src="https://smirnov-am.github.io/content/images/micropython-esp32-img/setup.jpeg" alt="setup" /></p>

<p>Cathode of the LED (-) is connected to GND pin on the boards. Anode (+) - to the pin 27</p>

<h2 id="code">Code</h2>

<p>Now let&rsquo;s create and infinite loop that will turn the LED on and off.</p>

<pre><code class="language-python">import time
from machine import Pin

led = Pin(27, Pin.OUT)

while True:
  led.value(1)
  print(&quot;{} led is ON&quot;.format(time.time()))  
  time.sleep(0.5)
  led.value(0)
  print(&quot;{} led is OFF&quot;.format(time.time()))  
  time.sleep(0.5)
</code></pre>

<p>In uPyCraft we can use <code>Tools -&gt; DownloadAndRun</code> to download the code to the system and run it.</p>

<p>IDE has a stdout output that can be used for monitoring and debugging:</p>

<p><img src="https://smirnov-am.github.io/content/images/micropython-esp32-img/stdout.png" alt="stdout" /></p>

<p>Working setup looks like this:</p>

<p><img src="https://smirnov-am.github.io/content/images/micropython-esp32-img/run.gif" alt="run" /></p>

      
      <div class="related">

<h3>Similar articles:</h3>
<ul>
	
	<li><a href="https://smirnov-am.github.io/amp/python-linters-for-better-code-quality/">Python linters for better code quality</a></li>
	
	<li><a href="https://smirnov-am.github.io/amp/representing-money-in-python/">Representing money in Python</a></li>
	
	<li><a href="https://smirnov-am.github.io/amp/ci-ci-pipeline-for-aws-lambda-python-runtime/">CI/CD  pipeline for AWS Lambda (Python runtime)</a></li>
	
	<li><a href="https://smirnov-am.github.io/amp/anomalies-in-bank-transactions/">Anomalies in bank transactions</a></li>
	
	<li><a href="https://smirnov-am.github.io/amp/calculating-enterprise-value-with-python-and-pandas-part-1-wacc-and-dcf/">Calculating enterprise value with Python and Pandas (part 2). WACC and DCF</a></li>
	
</ul>
</div>
      
    </div>
    
  </div>
</section>

    <script src="https://smirnov-am.github.io/js/copycode.js"></script>



<section class="section">
  <div class="container has-text-centered">
    <p>&copy; Alexey Smirnov 2020</p>
    
  </div>
</section>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-107429956-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




</body>
</html>

