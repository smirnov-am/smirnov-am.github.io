<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https:\/\/smirnov-am.github.io"
        },
        "articleSection" : "post",
        "name" : "Pytest plugins",
        "headline" : "Pytest plugins",
        "description" : "Other pytest articles:\nWhy testing is important\nTypes of tests\nTest driven Development\nHello, World!\nSelecting tests with pytest\nTesting HTTP client with pytest\nTesting database with pytest\nAdvanced fixtures with pytest\nPytest plugins\nThere are lot of plugins in pytest ecosystem. Some of the widely used are listed here All the plugins can be installed with pip and invoked by providing an argument to pytest executable.\npytest-cov This plugin calculates test coverage - how much of our code is covered by test.",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2020",
        "datePublished": "2020-09-06 18:41:00 \u002b0000 UTC",
        "dateModified" : "2020-09-06 18:41:00 \u002b0000 UTC",
        "url" : "https:\/\/smirnov-am.github.io\/amp\/pytest-plugins\/",
        "wordCount" : "510",
        "keywords" : [ "Python","pytest","Blog" ]
    }
    </script>

<title>Pytest plugins | Alexey Smirnov</title>

<meta property='og:title' content='Pytest plugins - Alexey Smirnov'>
<meta property='og:description' content='Other pytest articles:
Why testing is important
Types of tests
Test driven Development
Hello, World!
Selecting tests with pytest
Testing HTTP client with pytest
Testing database with pytest
Advanced fixtures with pytest
Pytest plugins
There are lot of plugins in pytest ecosystem. Some of the widely used are listed here All the plugins can be installed with pip and invoked by providing an argument to pytest executable.
pytest-cov This plugin calculates test coverage - how much of our code is covered by test.'>
<meta property='og:url' content='https://smirnov-am.github.io/amp/pytest-plugins/'>
<meta property='og:site_name' content='Alexey Smirnov'>
<meta property='og:type' content='article'><meta property='og:image' content='https://www.gravatar.com/avatar/f3f61e69a3bdf7419f19cb1be356c0b1?s=256'><meta property='article:section' content='Post'><meta property='article:tag' content='Python'><meta property='article:tag' content='pytest'><meta property='article:published_time' content='2020-09-06T18:41:00Z'/><meta property='article:modified_time' content='2020-09-06T18:41:00Z'/><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@'><meta name='twitter:creator' content='@'>


<link href="https://smirnov-am.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Alexey Smirnov" />

<link rel="stylesheet" href="https://smirnov-am.github.io/css/style.css"/><link rel="apple-touch-icon" sizes="180x180" href="https://smirnov-am.github.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://smirnov-am.github.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://smirnov-am.github.io/favicon-16x16.png">
<link rel="manifest" href="https://smirnov-am.github.io/site.webmanifest">
<link rel="mask-icon" href="https://smirnov-am.github.io/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://smirnov-am.github.io/amp/pytest-plugins/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<meta name="google-site-verification" content="LxHvTgaBdcBpIRtJMFKFiIvx5Mm45WC1z1S57O6O5O8" />
</head>
<body>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="https://smirnov-am.github.io/tags/python">#Python</a>



  
  | <a class="subtitle is-6" href="https://smirnov-am.github.io/tags/pytest">#pytest</a>
  

      
    </div>
    <h2 class="subtitle is-6">September 6, 2020</h2>
    <h1 class="title">Pytest plugins</h1>
    <section class="section" style="padding: 0px 0px;">
    <div class="content has-text-centered" >
        <h2><a href="https://smirnov-am.github.io/modern-web-development-flask">➡️Learn modern Web development with Python and Flask</a></h2>
    </div>
    
</section>
    <div class="content">
      <p>Other pytest articles:</p>
<p><a href="https://smirnov-am.github.io/pytest-why-testing">Why testing is important</a></p>
<p><a href="https://smirnov-am.github.io/pytest-test-types">Types of tests</a></p>
<p><a href="https://smirnov-am.github.io/pytest-tdd">Test driven Development</a></p>
<p><a href="https://smirnov-am.github.io/pytest-hello-world">Hello, World!</a></p>
<p><a href="https://smirnov-am.github.io/pytest-selecting_tests">Selecting tests with pytest</a></p>
<p><a href="https://smirnov-am.github.io/pytest-testing_http_client">Testing HTTP client with pytest</a></p>
<p><a href="https://smirnov-am.github.io/pytest-testing_database">Testing database with pytest</a></p>
<p><a href="https://smirnov-am.github.io/pytest-advanced-fixtures">Advanced fixtures with pytest</a></p>
<p><a href="https://smirnov-am.github.io/pytest-plugins">Pytest plugins</a></p>
<p>There are lot of plugins in pytest ecosystem. Some of the widely used are listed <a href="https://docs.pytest.org/en/5.4.3/plugins.html?highlight=plugins#installing-and-using-plugins">here</a>
All the plugins can be installed with pip and invoked by providing an argument to pytest executable.</p>
<h2 id="pytest-cov">pytest-cov</h2>
<p>This plugin calculates test coverage - how much of our code is covered by test. Since every project is unique it&rsquo;s difficult to tell an universally acceptable coverage (<a href="https://www.artima.com/forums/flat.jsp?forum=106&amp;thread=204677">https://www.artima.com/forums/flat.jsp?forum=106&amp;thread=204677</a>)</p>
<p>If we have all out source files in  <code>source/</code> folder and test in <code>test/</code> then we can run pytest with this plugin by</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pytest --cov<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;source&#34;</span> --cov-report<span style="color:#f92672">=</span>term-missing test/
</span></span></code></pre></div><p>cov-report argument will determine what report to generate.  <code>term-missing</code> report will tell exactly which lines are not covered by tests.</p>
<p>The output report looks like this</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>--- coverage: python 3.6.2-final-0 ---
</span></span><span style="display:flex;"><span>Name                       Stmts   Miss  Cover   Missing
</span></span><span style="display:flex;"><span>------------------------------------------------
</span></span><span style="display:flex;"><span>source/__init__.py             <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span>   100%
</span></span><span style="display:flex;"><span>source/api.py                 <span style="color:#ae81ff">12</span>      <span style="color:#ae81ff">4</span>    67%   10-11, 15-16
</span></span><span style="display:flex;"><span>source/database.py            <span style="color:#ae81ff">15</span>      <span style="color:#ae81ff">0</span>   100%
</span></span><span style="display:flex;"><span>source/exceptions.py           <span style="color:#ae81ff">2</span>      <span style="color:#ae81ff">0</span>   100%
</span></span><span style="display:flex;"><span>source/nnormalize.py          <span style="color:#ae81ff">14</span>      <span style="color:#ae81ff">4</span>    71%   6-9
</span></span><span style="display:flex;"><span>source/number_checker.py       <span style="color:#ae81ff">8</span>      <span style="color:#ae81ff">0</span>   100%
</span></span><span style="display:flex;"><span>------------------------------------------------
</span></span><span style="display:flex;"><span>TOTAL                         <span style="color:#ae81ff">51</span>      <span style="color:#ae81ff">8</span>    84%
</span></span></code></pre></div><h2 id="pytest-xdist">pytest-xdist</h2>
<p>This plugin will parallelize test execution. It will speed up executing of large test sets.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pytest -n <span style="color:#ae81ff">5</span> test/
</span></span></code></pre></div><p>Where 5 is a number of workers. It can also accept <code>auto</code> as a parameter. The pytest output is not changed when using this plugin (except some hint that it&rsquo;s running multiple processes)</p>
<h2 id="pytest-bdd">pytest-bdd</h2>
<p>This is a less technical plugin of the three I wanted to cover. This one allows to convert feature files written in Gherkin format to pytest cases.</p>
<p>We start working with pytest-bdd by creating a feature file in a <a href="https://cucumber.io/docs/gherkin/">Gherkin</a> format. This is a highly readable form to describe a feature or a user story and to fix business-side requirements.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gherkin" data-lang="gherkin"><span style="display:flex;"><span><span style="color:#66d9ef">Feature:</span><span style="color:#a6e22e"> Phone number validation application
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    </span><span style="color:#66d9ef">Scenario:</span><span style="color:#a6e22e"> validate a number
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span><span style="color:#66d9ef">        Given </span><span style="color:#a6e22e">I have a number +</span><span style="color:#e6db74">311234555</span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">        </span><span style="color:#66d9ef">When </span><span style="color:#a6e22e">I run number validation application
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">        </span><span style="color:#66d9ef">Then </span><span style="color:#a6e22e">Number is normalized 
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">        </span><span style="color:#66d9ef">And </span><span style="color:#a6e22e">Cache is checked for presence of this number
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">        </span><span style="color:#66d9ef">And </span><span style="color:#a6e22e">External API is called if cache doesn&#39;t contains the number 
</span></span></span></code></pre></div><p>With this file we can generate our test case:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pytest-bdd generate validation.feature &gt;&gt; test_number_validation.py
</span></span></code></pre></div><p>Test file appears to be pretty long, but here is some main points:</p>
<ul>
<li>there is a functions decorated with <code>given</code>, <code>when</code>, <code>then</code> decorators from pytest-bdd like</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@given</span>(<span style="color:#e6db74">&#39;I have a number +311234555&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">i_have_a_number_311234555</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;I have a number +311234555.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">NotImplementedError</span>
</span></span></code></pre></div><ul>
<li>the decorator input string is what we have written in a feature file</li>
<li>functions decorated with @given are recognized as fixtures, so they can be passed to a last function, decorated with <code>@then</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@given</span>(<span style="color:#e6db74">&#39;I have a number +311234555&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">i_have_a_number_311234555</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;I have a number +311234555.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;+311234555&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@when</span>(<span style="color:#e6db74">&#39;I run number validation application&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">i_run_number_validation_application</span>(i_have_a_number_311234555):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># do stuff and use </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># i_have_a_number_311234555 holding out test number</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">NotImplementedError</span>
</span></span></code></pre></div><p>This might look like an unnecessary extra step, but some organizations find it useful to fix business requirements.</p>
<p>This is the last unit in this course. Thanks for staying with me and I hope that you find this content valuable.</p>


      
      <div class="related">

<h3>Similar articles:</h3>
<ul>
	
	<li><a href="https://smirnov-am.github.io/amp/pytest-advanced-fixtures/">Advanced fixtures with pytest</a></li>
	
	<li><a href="https://smirnov-am.github.io/amp/pytest-hello-world/">Hello, World!</a></li>
	
	<li><a href="https://smirnov-am.github.io/amp/pytest-selecting_tests/">Selecting tests with pytest</a></li>
	
	<li><a href="https://smirnov-am.github.io/amp/pytest-tdd/">Test driven Development</a></li>
	
	<li><a href="https://smirnov-am.github.io/amp/pytest-testing_http_client/">Testing HTTP client with pytest</a></li>
	
</ul>
</div>
      
    </div>
  </div>
</section>

    <script src="https://smirnov-am.github.io/js/copycode.js"></script>



<section class="section">
  <div class="container has-text-centered">
    <p>&copy; Alexey Smirnov 2021</p>
    
  </div>
</section>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-107429956-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




</body>
</html>

