<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Basic Financial Calculations with Python and Pandas</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css?v=e6220510ab" />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="canonical" href="https://smirnov-am.github.io/basic-financial-calculations-with-python-and-pandas/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://smirnov-am.github.io/basic-financial-calculations-with-python-and-pandas/amp/" />
    
    <meta property="og:site_name" content="smirnov-am.github.io" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Basic Financial Calculations with Python and Pandas" />
    <meta property="og:description" content="In this post I&#x27;ll cover:

 * Net present value (NPV)
 * Internal rate of return (IRR)
 * Payment schedules and loan tables
 * Future value
 * Pension and accumulation problems
 * Continuously compounded interest

Net present value
Present value allows to answer a simple question &quot;should I put my money in a
bank or invest&quot;. Let&#x27;s say I have $100 and the bank gives a 12% annual interest
rate. Alternatively, I can lend this money to a friend and he promises to pay
$10 for 12 months. The moral aspec" />
    <meta property="og:url" content="https://smirnov-am.github.io/basic-financial-calculations-with-python-and-pandas/" />
    <meta property="og:image" content="https://smirnov-am.github.io/content/images/2019/04/pyfinmod1.png" />
    <meta property="article:published_time" content="2018-12-24T19:48:00.000Z" />
    <meta property="article:modified_time" content="2019-04-29T18:30:23.000Z" />
    <meta property="article:tag" content="Financial Modelling" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Basic Financial Calculations with Python and Pandas" />
    <meta name="twitter:description" content="In this post I&#x27;ll cover:

 * Net present value (NPV)
 * Internal rate of return (IRR)
 * Payment schedules and loan tables
 * Future value
 * Pension and accumulation problems
 * Continuously compounded interest

Net present value
Present value allows to answer a simple question &quot;should I put my money in a
bank or invest&quot;. Let&#x27;s say I have $100 and the bank gives a 12% annual interest
rate. Alternatively, I can lend this money to a friend and he promises to pay
$10 for 12 months. The moral aspec" />
    <meta name="twitter:url" content="https://smirnov-am.github.io/basic-financial-calculations-with-python-and-pandas/" />
    <meta name="twitter:image" content="https://smirnov-am.github.io/content/images/2019/04/pyfinmod1.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Alexey Smirnov" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Financial Modelling" />
    <meta property="og:image:width" content="2047" />
    <meta property="og:image:height" content="2012" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "smirnov-am.github.io",
        "logo": {
            "@type": "ImageObject",
            "url": "https://smirnov-am.github.io/favicon.ico",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Alexey Smirnov",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/f3f61e69a3bdf7419f19cb1be356c0b1?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "https://smirnov-am.github.io/author/alexey/",
        "sameAs": []
    },
    "headline": "Basic Financial Calculations with Python and Pandas",
    "url": "https://smirnov-am.github.io/basic-financial-calculations-with-python-and-pandas/",
    "datePublished": "2018-12-24T19:48:00.000Z",
    "dateModified": "2019-04-29T18:30:23.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://smirnov-am.github.io/content/images/2019/04/pyfinmod1.png",
        "width": 2047,
        "height": 2012
    },
    "keywords": "Financial Modelling",
    "description": "In this post I&#x27;ll cover:\n\n * Net present value (NPV)\n * Internal rate of return (IRR)\n * Payment schedules and loan tables\n * Future value\n * Pension and accumulation problems\n * Continuously compounded interest\n\nNet present value\nPresent value allows to answer a simple question &quot;should I put my money in a\nbank or invest&quot;. Let&#x27;s say I have $100 and the bank gives a 12% annual interest\nrate. Alternatively, I can lend this money to a friend and he promises to pay\n$10 for 12 months. The moral aspec",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://smirnov-am.github.io/"
    }
}
    </script>

    <meta name="generator" content="Ghost 2.21" />
    <link rel="alternate" type="application/rss+xml" title="smirnov-am.github.io" href="https://smirnov-am.github.io/rss/" />
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-107429956-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-107429956-1');
</script>

</head>
<body class="post-template tag-financial-modelling">

    <div class="site-wrapper">

        

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
                <a class="site-nav-logo" href="https://smirnov-am.github.io">smirnov-am.github.io</a>
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="https://smirnov-am.github.io/">Home</a></li>
    <li class="nav-github" role="menuitem"><a href="https://github.com/smirnov-am">GitHub</a></li>
    <li class="nav-linkedin" role="menuitem"><a href="https://www.linkedin.com/in/smirnovam/">LinkedIn</a></li>
    <li class="nav-bookshelf" role="menuitem"><a href="https://www.goodreads.com/review/list/100768091-alex-smirnov">Bookshelf</a></li>
</ul>

    </div>
    <div class="site-nav-right">
        <div class="social-links">
        </div>
            <a class="rss-button" href="https://feedly.com/i/subscription/feed/https://smirnov-am.github.io/rss/" title="RSS" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg>
</a>
    </div>
</nav>
    </div>
</header>


<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post tag-financial-modelling ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="2018-12-24">24 December 2018</time>
                        <span class="date-divider">/</span> <a href="/tag/financial-modelling/">Financial Modelling</a>
                </section>
                <h1 class="post-full-title">Basic Financial Calculations with Python and Pandas</h1>
            </header>

            <figure class="post-full-image">
                <img
                    srcset="/content/images/size/w300/2019/04/pyfinmod1.png 300w,
                            /content/images/size/w600/2019/04/pyfinmod1.png 600w,
                            /content/images/size/w1000/2019/04/pyfinmod1.png 1000w,
                            /content/images/size/w2000/2019/04/pyfinmod1.png 2000w"
                    sizes="(max-width: 800px) 400px,
                            (max-width: 1170px) 700px,
                            1400px"
                    src="/content/images/size/w2000/2019/04/pyfinmod1.png"
                    alt="Basic Financial Calculations with Python and Pandas"
                />
            </figure>

            <section class="post-full-content">
                <div class="post-content">
                    <p>In this post I'll cover:</p><ul><li>Net present value (NPV)</li><li>Internal rate of return (IRR)</li><li>Payment schedules and loan tables</li><li>Future value</li><li>Pension and accumulation problems</li><li>Continuously compounded interest</li></ul><h2 id="net-present-value">Net present value</h2><p>Present value allows to answer a simple question "should I put my money in a bank or invest". Let's say I have $100 and the bank gives a 12% annual interest rate. Alternatively, I can lend this money to a friend and he promises to pay $10 for 12 months. The moral aspect aside NPV gives an answer which alternative is more profitable.</p><p>The second alternative can be described as a series of cash flows:</p><ul><li>-$100 at month=0</li><li>+$10 at month=1</li><li>...</li><li>+$10 at month=12</li></ul><p>At each period value should be adjusted by the interest rate (also called the discount rate) using formula</p><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://smirnov-am.github.io/content/images/2019/04/2019-04-29-19.27.19.jpg" class="kg-image"></figure><!--kg-card-end: image--><p>This basic concept shows that $100 now is not the same as $100 promised in a year. $100 now is $110 in a year.</p><p>To calculate the discounted value I'll convert annual discount (interest) rate to daily and use the number of days elapsed as <em>t</em>. The function accepts a dataframe with a date column and a cash flow column.</p><!--kg-card-begin: code--><pre><code>def npv(dataframe, 
        annual_discount_rate, 
        cash_flow_column_name='cash flow', 
        date_column_name='date'):
    date_start = dataframe[date_column_name].min()
    mapper = lambda x: _calculate_discounted(x[cash_flow_column_name], 
                                             annual_discount_rate, 
                                             (x[date_column_name] - date_start).days)
    return dataframe[[cash_flow_column_name, date_column_name]].apply(mapper, axis=1).sum()

def _calculate_discounted(cf, annual_interest_rate, days_passed):
    daily_interest_rate = convert_ir(annual_interest_rate, from_period='year', to_period='day')
    return cf / (1 + daily_interest_rate)**days_passed
</code></pre><!--kg-card-end: code--><p>Let's calculate NPV of lending to a friend:</p><!--kg-card-begin: code--><pre><code>&gt;&gt;&gt; import pandas as pd
&gt;&gt;&gt; from datetime import date, timedelta
&gt;&gt;&gt; from dateutil.relativedelta import relativedelta
&gt;&gt;&gt; dates = [date.today() + relativedelta(months=i) for i in range(13)]
&gt;&gt;&gt; df = pd.DataFrame(data={'cash flow': [-100] + [10]*12, 
                            'date': dates})
&gt;&gt;&gt; npv(df, 0.1)
14.011086147172053
</code></pre><!--kg-card-end: code--><p>The calculated NPV of lending alternative is ~$14 which means that it is profitable. This value represents your wealth increment.  Companies use NPV<br>to calculate if it's, for example, viable to invest in a factory that will generate cash flows in the future or it's better to put the money elsewhere.</p><p><code>npv</code> function can also operate with time-dated cash flows - that is when the cash flows are not evenly placed.</p><h2 id="internal-rate-of-returns">Internal rate of returns</h2><p>So I decided to lend to a friend. What is the effective interest rate for this alternative? Internal rate of returns (IRR) answers that. The solution of the following equation for <em>r</em> gives IRR:</p><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://smirnov-am.github.io/content/images/2019/04/2019-04-29-19.27.27.jpg" class="kg-image"></figure><!--kg-card-end: image--><p>Effectively we are finding interest rate when NPV is 0.</p><p>The function will accept the same dataframe as an input. I'm using scipy numerical <a href="https://docs.scipy.org/doc/scipy-0.13.0/reference/generated/scipy.optimize.fsolve.html">solver</a> to find <em>r</em>. The solver accepts the initial <em>guess</em> argument which helps to find the solution.</p><!--kg-card-begin: code--><pre><code>def irr(dataframe, guess=0, cash_flow_column_name='cash flow', date_column_name='date'):
    f = partial(npv, dataframe, cash_flow_column_name=cash_flow_column_name)
    result = fsolve(f, guess)
    return list(result)
</code></pre><!--kg-card-end: code--><!--kg-card-begin: code--><pre><code>&gt;&gt;&gt; irr(df, 0.0)
[0.41354120272404077]
</code></pre><!--kg-card-end: code--><p>Lending to a friend has an effective interest rate of 41%</p><p>Sometimes a series of cash flows can have more than one IRR. We can play with <em>guess</em> to find both solutions.</p><!--kg-card-begin: code--><pre><code>&gt;&gt;&gt; dates = [date.today() + relativedelta(years=i) for i in range(6)]
&gt;&gt;&gt; df3 = pd.DataFrame(data={'cash flow': [-145, 100, 100, 100, 100, -275],                              'date': dates})
&gt;&gt;&gt; irr(df3, 0.1), irr(df3, 0.4)
([0.08793680470699422], [0.26585705483081506])
</code></pre><!--kg-card-end: code--><h2 id="flat-payment-schedules">Flat payment schedules</h2><p>Let's look at the lending problems from the friend's point of view. He knows that with the cash flow he proposed he will be paying 41% annual interest rate. He wants to lower the interest rate to say 30% and calculates a new flat payment scheme. Flat here means that he will pay a constant amount each month for a <em>term</em> amount of months.</p><p>First, let's calculate the monthly payment. Function argument will be</p><ul><li><em>principal</em> - the lending amount</li><li><em>annual_interest_rate</em> - agreed interest rate in a term of a year</li><li><em>term</em> - how many terms to pay</li><li><em>period</em> - unit of a <em>term</em></li></ul><!--kg-card-begin: code--><pre><code>def pmt(principal, annual_interest_rate, term, period='year'):
    periodic_interest = convert_ir(annual_interest_rate, from_period='year', to_period=period)
    payment = (principal*periodic_interest)/(1 - (1 + periodic_interest)**(-term))
    return payment
</code></pre><!--kg-card-end: code--><!--kg-card-begin: code--><pre><code>&gt;&gt;&gt; pmt(100, 0.3, 12, period='month')
9.57859525723352
</code></pre><!--kg-card-end: code--><p>So he will be paying ~$9.6 each month. Now he wants to know how fast he's re-paying the interest and the principal. For that, a loan table is used.</p><!--kg-card-begin: code--><pre><code>def flat_payments(principal, annual_interest_rate, term, period='year'):
    _pmt = pmt(principal, annual_interest_rate, term, period=period)
    data = defaultdict(list)
    current_principal = principal
    principal_col_name = 'principal at the beginning of {}'.format(period)
    payment_col_name = 'payment at the end of {}'.format(period)
    interest_col_name = 'interest'
    return_principal_col_name = 'return of principal'
    periodic_interest = convert_ir(annual_interest_rate, from_period='year', to_period=period)
    for _t in range(1, term + 1):
        data[period].append(_t)
        data[principal_col_name].append(current_principal)
        data[payment_col_name] = _pmt
        current_interest = current_principal * periodic_interest
        data[interest_col_name].append(current_interest)
        current_return_of_principal = _pmt - current_interest
        data[return_principal_col_name].append(current_return_of_principal)
        current_principal -= current_return_of_principal  
    assert round(current_principal) == 0
    return pd.DataFrame.from_dict(data)
</code></pre><!--kg-card-end: code--><!--kg-card-begin: code--><pre><code>&gt;&gt;&gt; res_df = flat_payments(100, 0.3, 12, period='month')
&gt;&gt;&gt; print(tabulate(res_df, tablefmt="pipe", headers="keys"))
</code></pre><!--kg-card-end: code--><!--kg-card-begin: markdown--><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">month</th>
<th style="text-align:right">principal at the beginning of month</th>
<th style="text-align:right">payment at the end of month</th>
<th style="text-align:right">interest</th>
<th style="text-align:right">return of principal</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">100</td>
<td style="text-align:right">9.5786</td>
<td style="text-align:right">2.21045</td>
<td style="text-align:right">7.36815</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">92.6318</td>
<td style="text-align:right">9.5786</td>
<td style="text-align:right">2.04758</td>
<td style="text-align:right">7.53102</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">85.1008</td>
<td style="text-align:right">9.5786</td>
<td style="text-align:right">1.88111</td>
<td style="text-align:right">7.69749</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">77.4033</td>
<td style="text-align:right">9.5786</td>
<td style="text-align:right">1.71096</td>
<td style="text-align:right">7.86764</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">69.5357</td>
<td style="text-align:right">9.5786</td>
<td style="text-align:right">1.53705</td>
<td style="text-align:right">8.04155</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">6</td>
<td style="text-align:right">61.4942</td>
<td style="text-align:right">9.5786</td>
<td style="text-align:right">1.35929</td>
<td style="text-align:right">8.2193</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">7</td>
<td style="text-align:right">53.2749</td>
<td style="text-align:right">9.5786</td>
<td style="text-align:right">1.17761</td>
<td style="text-align:right">8.40098</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">8</td>
<td style="text-align:right">44.8739</td>
<td style="text-align:right">9.5786</td>
<td style="text-align:right">0.991912</td>
<td style="text-align:right">8.58668</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">9</td>
<td style="text-align:right">36.2872</td>
<td style="text-align:right">9.5786</td>
<td style="text-align:right">0.802108</td>
<td style="text-align:right">8.77649</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">10</td>
<td style="text-align:right">27.5107</td>
<td style="text-align:right">9.5786</td>
<td style="text-align:right">0.608109</td>
<td style="text-align:right">8.97049</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">11</td>
<td style="text-align:right">18.5402</td>
<td style="text-align:right">9.5786</td>
<td style="text-align:right">0.409821</td>
<td style="text-align:right">9.16877</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">12</td>
<td style="text-align:right">9.37144</td>
<td style="text-align:right">9.5786</td>
<td style="text-align:right">0.207151</td>
<td style="text-align:right">9.37144</td>
</tr>
</tbody>
</table>
<!--kg-card-end: markdown--><p>I'm using <a href="https://pypi.org/project/tabulate/">tabulate</a> to print dataframes in the terminal.</p><p>The last two columns - <em>interest</em> and <em>return of principal</em> - show how the payment is split between repaying interest and principal. At the end, principal value should be 0 (see assert in function code). It's interesting to know how much interest is re-payed because that amount sometimes is tax deductible.</p><h2 id="future-value">Future value</h2><p>Let’s imagine we put $10000 today for 10 years with an annual interest rate 10%. How much money we will have in 10 years? Using this formula with r=0.1 ant t=10 will give us $2593.74:</p><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://smirnov-am.github.io/content/images/2019/04/2019-04-29-19.27.34.jpg" class="kg-image"></figure><!--kg-card-end: image--><p>A slightly more complex problem is if we want to deposit some money during these 10 years. The f<em>uture value</em> will tell how much money we'll have in the end of the period.</p><p>The function accepts a list of deposit amounts and, annual interest rate and a period at which deposits are made</p><!--kg-card-begin: code--><pre><code>def fv(deposits, annual_interest_rate, period='year'):
    periodic_interest = convert_ir(annual_interest_rate, from_period='year', to_period=period)
    future_value = 0
    number_of_deposits = len(deposits)
    for n, deposit in enumerate(deposits):
        future_value += deposit * (1 + periodic_interest)**(number_of_deposits - n)
    return future_value
</code></pre><!--kg-card-end: code--><!--kg-card-begin: code--><pre><code>&gt;&gt;&gt; fv([1000 for _ in range(10)], 0.1, period='year')
17531.16706110001
</code></pre><!--kg-card-end: code--><p>So depositing $1000 for 10 years will yield $17.5k given the interest rate is 10%.</p><h2 id="retirement-problem">Retirement problem</h2><p>Consider the following exercise. Now I'm 31 and planning to retire at 55 (24 more years working). After retiring I'm planning to live at least 25 more years and will need, say, $50000 a year. To support my retirement I need to deposit money into a bank account with known interest rate (say 5%). What's the minimum amount do I need to deposit each year?</p><p>This problem implies a number of cash flows: 24 terms with CF=<em>x</em> at each time, and 25 terms with CF=-50000. The present value of this cash flows should be 0. Solving this equation for <em>x</em> will give the minimum annual deposit. The minimum deposit is used here not in a mathematical sense, but more in common sense - I'll live more that 25 years after retirement, prices are also going up so I'll need more than 50k yearly.</p><!--kg-card-begin: code--><pre><code>def get_retirement_cf_dataframe(deposit, terms_of_deposit, withdrawal, terms_of_withdrawal, period='year'):
    cash_flows = [deposit]*terms_of_deposit + [-withdrawal]*terms_of_withdrawal
    terms = terms_of_deposit + terms_of_withdrawal
    dates = [date.today() + relativedelta(**{period + 's':i}) for i in range(terms)]
    df = pd.DataFrame(data={'cash flow': cash_flows, 'date': dates})
    return df


def retirement_problem(terms_of_deposit, 
                       withdrawal, 
                       terms_of_withdrawal, 
                       annual_discount_rate, 
                       period='year'):
    df_by_deposit = partial(get_retirement_cf_dataframe, 
                            terms_of_deposit=terms_of_deposit, 
                            withdrawal=withdrawal, 
                            terms_of_withdrawal=terms_of_withdrawal, 
                            period=period)
    f = lambda deposit: npv(retirement_dataframe_by_deposit(deposit), annual_discount_rate)
    result = fsolve(f, withdrawal)
    return list(result)
</code></pre><!--kg-card-end: code--><!--kg-card-begin: code--><pre><code>&gt;&gt;&gt; retirement_problem(24, 50000, 25, 0.05)
[15822.327630785972]
</code></pre><!--kg-card-end: code--><p>That's a pretty cool result - I need to deposit only ~$16k yearly for 24 years to be able to withdraw $50k for 25 years later. That's compound interest working.</p><h2 id="continuous-compounding">Continuous compounding</h2><p>I'm using <code>convert_ir(r, from_period='year', to_period='day')</code> function to convert from annual interest rate to daily interest rate in some examples above.<br>So if I have an annual rate of 20%, a quarterly rate is:</p><!--kg-card-begin: code--><pre><code>&gt;&gt;&gt; convert_ir(0.2, from_period='year', to_period='quater')
0.04663513939210562
</code></pre><!--kg-card-end: code--><p>And respective annual is:</p><!--kg-card-begin: code--><pre><code>&gt;&gt;&gt; 4 * convert_ir(0.2, from_period='year', to_period='quater')
</code></pre><!--kg-card-end: code--><p>So if a bank offers a 20% annual interest rate paid quarterly the effective annual interest rate is 18.6%. So if the number of interest payments increases - for example to every millisecond -  this is called continuous compounding. Let's calculate the annual interest rate continuously compounded given initial and end amounts.</p><!--kg-card-begin: code--><pre><code>def get_annual_rate_cc(dataframe, amount_column_name='amount', date_column_name='date'):
    amount_first = dataframe[amount_column_name].iloc[0]
    amount_last = dataframe[amount_column_name].iloc[-1]
    date_first = dataframe[date_column_name].iloc[0]
    date_last = dataframe[date_column_name].iloc[-1]
    delta = relativedelta(date_last, date_first)
    t = delta.years + delta.months/12 + delta.days/365
    r = log(amount_last/amount_first)/t
    return r
</code></pre><!--kg-card-end: code--><!--kg-card-begin: code--><pre><code>&gt;&gt;&gt; df = pd.DataFrame(data={'amount': [1000, 1500], 'date': [date.today(), date.today() + relativedelta(years=1, months=9)]})
&gt;&gt;&gt; print(tabulate(df, tablefmt="pipe", headers="keys"))
</code></pre><!--kg-card-end: code--><!--kg-card-begin: markdown--><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">amount</th>
<th style="text-align:left">date</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1000</td>
<td style="text-align:left">2018-12-24</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1500</td>
<td style="text-align:left">2020-09-24</td>
</tr>
</tbody>
</table>
<!--kg-card-end: markdown--><!--kg-card-begin: code--><pre><code>&gt;&gt;&gt; get_annual_rate_cc(df)
0.23169434749037965
</code></pre><!--kg-card-end: code--><p>Continuous compounding is used in many financial calculations.</p><h2 id="code">Code</h2><p>I'm planning to gather all the financial modeling methods including the ones form this post in a repo <a href="https://github.com/smirnov-am/pyfinmod">here</a>. Feel free to reach out to me over <a href="https://www.linkedin.com/in/smirnovam/">LinkedIn</a> for any questions.</p>
                </div>
            </section>


            <footer class="post-full-footer">


                    
<section class="author-card">
        <img class="author-profile-image" src="//www.gravatar.com/avatar/f3f61e69a3bdf7419f19cb1be356c0b1?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x" alt="Alexey Smirnov" />
    <section class="author-card-content">
        <h4 class="author-card-name"><a href="/author/alexey/">Alexey Smirnov</a></h4>
            <p>Read <a href="/author/alexey/">more posts</a> by this author.</p>
    </section>
</section>
<div class="post-full-footer-right">
    <a class="author-card-button" href="/author/alexey/">Read More</a>
</div>


            </footer>


        </article>

    </div>
</main>

<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
                <article class="read-next-card"

                >
                    <header class="read-next-card-header">
                        <small class="read-next-card-header-sitetitle">&mdash; smirnov-am.github.io &mdash;</small>
                        <h3 class="read-next-card-header-title"><a href="/tag/financial-modelling/">Financial Modelling</a></h3>
                    </header>
                    <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                    <div class="read-next-card-content">
                        <ul>
                            <li><a href="/calculating-enterprise-value-with-python-and-pandas-part-1-wacc-and-dcf/">Calculating enterprise value with Python and Pandas (part 2). WACC and DCF</a></li>
                            <li><a href="/calculating-enterprise-value-with-python-and-pandas-part-1-fcf/">Calculating enterprise value with Python and Pandas (part 1). FCF</a></li>
                        </ul>
                    </div>
                    <footer class="read-next-card-footer">
                        <a href="/tag/financial-modelling/">See all 2 posts →</a>
                    </footer>
                </article>

                <article class="post-card post tag-financial-modelling ">

    <a class="post-card-image-link" href="/calculating-enterprise-value-with-python-and-pandas-part-1-fcf/">
        <img class="post-card-image"
            srcset="/content/images/size/w300/2019/04/pyfinmod2--1-.png 300w,
                    /content/images/size/w600/2019/04/pyfinmod2--1-.png 600w,
                    /content/images/size/w1000/2019/04/pyfinmod2--1-.png 1000w,
                    /content/images/size/w2000/2019/04/pyfinmod2--1-.png 2000w"
            sizes="(max-width: 1000px) 400px, 700px"
            src="/content/images/size/w600/2019/04/pyfinmod2--1-.png"
            alt="Calculating enterprise value with Python and Pandas (part 1). FCF"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/calculating-enterprise-value-with-python-and-pandas-part-1-fcf/">

            <header class="post-card-header">
                    <span class="post-card-tags">Financial Modelling</span>
                <h2 class="post-card-title">Calculating enterprise value with Python and Pandas (part 1). FCF</h2>
            </header>

            <section class="post-card-excerpt">
                <p>Enterprise ValueValue of the enterprise may be used to find out whether the price of company equity - a share - is worth what market offers. It's also used in acquisitions to get</p>
            </section>

        </a>

        <footer class="post-card-meta">

            <ul class="author-list">
                <li class="author-list-item">

                    <div class="author-name-tooltip">
                        Alexey Smirnov
                    </div>

                        <a href="/author/alexey/" class="static-avatar">
                            <img class="author-profile-image" src="//www.gravatar.com/avatar/f3f61e69a3bdf7419f19cb1be356c0b1?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x" alt="Alexey Smirnov" />
                        </a>
                </li>
            </ul>

            <span class="reading-time">4 min read</span>

        </footer>

    </div>

</article>

                <article class="post-card post tag-flask ">

    <a class="post-card-image-link" href="/streaming-timeseries-with-flask-and-plotly/">
        <img class="post-card-image"
            srcset="/content/images/size/w300/2019/04/task-manager-3-.png 300w,
                    /content/images/size/w600/2019/04/task-manager-3-.png 600w,
                    /content/images/size/w1000/2019/04/task-manager-3-.png 1000w,
                    /content/images/size/w2000/2019/04/task-manager-3-.png 2000w"
            sizes="(max-width: 1000px) 400px, 700px"
            src="/content/images/size/w600/2019/04/task-manager-3-.png"
            alt="Streaming timeseries with Flask and Plotly"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/streaming-timeseries-with-flask-and-plotly/">

            <header class="post-card-header">
                    <span class="post-card-tags">Flask</span>
                <h2 class="post-card-title">Streaming timeseries with Flask and Plotly</h2>
            </header>

            <section class="post-card-excerpt">
                <p>This simple app for streaming cpu utilization to a web page. I'm using Flask as websockets server (flask-socketio plugin), socket.io as client library and plotly.jsfor visualization.Flask appI'm following a flask-socketio</p>
            </section>

        </a>

        <footer class="post-card-meta">

            <ul class="author-list">
                <li class="author-list-item">

                    <div class="author-name-tooltip">
                        Alexey Smirnov
                    </div>

                        <a href="/author/alexey/" class="static-avatar">
                            <img class="author-profile-image" src="//www.gravatar.com/avatar/f3f61e69a3bdf7419f19cb1be356c0b1?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x" alt="Alexey Smirnov" />
                        </a>
                </li>
            </ul>

            <span class="reading-time">3 min read</span>

        </footer>

    </div>

</article>

        </div>
    </div>
</aside>

<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://smirnov-am.github.io">
            <span>smirnov-am.github.io</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Basic Financial Calculations with Python and Pandas</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-fb" href="https://www.linkedin.com/shareArticle?url=https://smirnov-am.github.io/basic-financial-calculations-with-python-and-pandas/&title=Basic%20Financial%20Calculations%20with%20Python%20and%20Pandas" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
width="26" height="26"
viewBox="0 0 192 192"
style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,192v-192h192v192z" fill="none"></path><g fill="#ffffff"><g id="surface1"><path d="M156,0h-120c-19.875,0 -36,16.125 -36,36v120c0,19.875 16.125,36 36,36h120c19.875,0 36,-16.125 36,-36v-120c0,-19.875 -16.125,-36 -36,-36zM59.36539,162.98077h-29.82693l-0.17307,-89.30769h29.82692zM43.70192,61.99038h-0.17308c-9.75,0 -16.03846,-6.72115 -16.03846,-15.08653c0,-8.56731 6.49039,-15.0577 16.41347,-15.0577c9.92308,0 16.00961,6.49038 16.21153,15.0577c0,8.36538 -6.31731,15.08653 -16.41346,15.08653zM162.77885,162.98077h-30.08654v-48.51923c0,-11.74039 -3.11538,-19.73077 -13.61538,-19.73077c-8.01923,0 -12.34615,5.39423 -14.42308,10.61538c-0.77885,1.875 -0.98077,4.44231 -0.98077,7.06731v50.56731h-30.23077l-0.17308,-89.30769h30.23077l0.17308,12.60577c3.86538,-5.97116 10.29808,-14.42308 25.70192,-14.42308c19.09616,0 33.37501,12.46154 33.37501,39.25961v51.86539z"></path></g></g></g></svg>
</a>
        <a class="floating-header-share-tw" href="http://www.reddit.com/submit?url=https://smirnov-am.github.io/basic-financial-calculations-with-python-and-pandas/&title=Basic%20Financial%20Calculations%20with%20Python%20and%20Pandas" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M14.238 15.348c.085.084.085.221 0 .306-.465.462-1.194.687-2.231.687l-.008-.002-.008.002c-1.036 0-1.766-.225-2.231-.688-.085-.084-.085-.221 0-.305.084-.084.222-.084.307 0 .379.377 1.008.561 1.924.561l.008.002.008-.002c.915 0 1.544-.184 1.924-.561.085-.084.223-.084.307 0zm-3.44-2.418c0-.507-.414-.919-.922-.919-.509 0-.923.412-.923.919 0 .506.414.918.923.918.508.001.922-.411.922-.918zm13.202-.93c0 6.627-5.373 12-12 12s-12-5.373-12-12 5.373-12 12-12 12 5.373 12 12zm-5-.129c0-.851-.695-1.543-1.55-1.543-.417 0-.795.167-1.074.435-1.056-.695-2.485-1.137-4.066-1.194l.865-2.724 2.343.549-.003.034c0 .696.569 1.262 1.268 1.262.699 0 1.267-.566 1.267-1.262s-.568-1.262-1.267-1.262c-.537 0-.994.335-1.179.804l-2.525-.592c-.11-.027-.223.037-.257.145l-.965 3.038c-1.656.02-3.155.466-4.258 1.181-.277-.255-.644-.415-1.05-.415-.854.001-1.549.693-1.549 1.544 0 .566.311 1.056.768 1.325-.03.164-.05.331-.05.5 0 2.281 2.805 4.137 6.253 4.137s6.253-1.856 6.253-4.137c0-.16-.017-.317-.044-.472.486-.261.82-.766.82-1.353zm-4.872.141c-.509 0-.922.412-.922.919 0 .506.414.918.922.918s.922-.412.922-.918c0-.507-.413-.919-.922-.919z"/></svg></a>
        <a class="floating-header-share-fb" href="https://news.ycombinator.com/submitlink?u=https://smirnov-am.github.io/basic-financial-calculations-with-python-and-pandas/&t=Basic%20Financial%20Calculations%20with%20Python%20and%20Pandas" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
width="100" height="100"
viewBox="0 0 50 50"
style=" fill:#000000;">    <path d="M 4 4 L 4 5 L 4 46 L 46 46 L 46 4 L 4 4 z M 6 6 L 44 6 L 44 44 L 6 44 L 6 6 z M 12.652344 13 L 14.238281 15.947266 L 21 28.503906 L 21 36 L 21 38 L 23 38 L 27 38 L 29 38 L 29 36 L 29 28.503906 L 35.761719 15.947266 L 37.347656 13 L 34 13 L 30.824219 13 L 29.664062 13 L 29.087891 14.007812 L 25 21.158203 L 20.912109 14.007812 L 20.337891 13 L 19.177734 13 L 16 13 L 12.652344 13 z M 16 15 L 19.175781 15 L 25 25.1875 L 30.824219 15 L 34 15 L 27 28 L 27 36 L 23 36 L 23 28 L 16 15 z"></path></svg></a>
    </div>
    <progress id="reading-progress" class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>




        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://smirnov-am.github.io">smirnov-am.github.io</a> &copy; 2019</section>
                <nav class="site-footer-nav">
                    <a href="https://smirnov-am.github.io">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>


    <script>
        var images = document.querySelectorAll('.kg-gallery-image img');
        images.forEach(function (image) {
            var container = image.closest('.kg-gallery-image');
            var width = image.attributes.width.value;
            var height = image.attributes.height.value;
            var ratio = width / height;
            container.style.flex = ratio + ' 1 0%';
        })
    </script>


    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/built/jquery.fitvids.js?v=e6220510ab"></script>


    <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('#reading-progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();

});
</script>


    

</body>
</html>
